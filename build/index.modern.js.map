{"version":3,"sources":["webpack://SimpleKeyboard/webpack/universalModuleDefinition","webpack://SimpleKeyboard/webpack/bootstrap","webpack://SimpleKeyboard/webpack/runtime/define property getters","webpack://SimpleKeyboard/webpack/runtime/hasOwnProperty shorthand","webpack://SimpleKeyboard/webpack/runtime/make namespace object","webpack://SimpleKeyboard/./src/lib/services/Utilities.ts","webpack://SimpleKeyboard/./src/lib/services/PhysicalKeyboard.ts","webpack://SimpleKeyboard/./src/lib/components/CandidateBox.ts","webpack://SimpleKeyboard/./src/lib/components/Keyboard.ts","webpack://SimpleKeyboard/./src/lib/services/KeyboardLayout.ts","webpack://SimpleKeyboard/./src/lib/index.modern.ts"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","Utilities","getOptions","getCaretPosition","getCaretPositionEnd","dispatch","button","length","bindMethods","includes","buttonTypeClass","getButtonType","buttonWithoutBraces","replace","buttonNormalized","display","mergeDisplay","assign","getDefaultDiplay","input","caretPos","caretPosEnd","moveCaret","options","commonParams","output","removeAt","removeForwardsAt","addStringAt","tabCharOnTab","newLineOnEnter","Number","isInteger","minus","newCaretPos","updateCaretPosAction","instance","setCaretPosition","caretPosition","debug","console","log","source","str","position","positionEnd","slice","join","isMaxLengthReached","updateCaretPos","emojiMatchedReg","substring","match","substr","nextTwoChars","emojiMatched","inputObj","updatedInput","maxLength","currentInput","inputName","condition","maxLengthReached","Boolean","window","navigator","maxTouchPoints","PointerEvent","toLowerCase","trim","split","reduce","word","toUpperCase","arr","size","Array","Math","ceil","map","_","i","index","newIndex","startMarkerIndex","indexOf","myClass","getOwnPropertyNames","myMethod","bind","PhysicalKeyboard","event","buttonPressed","getSimpleKeyboardLayoutKey","buttonDOM","buttonName","standardButtonPressed","getButtonElement","functionButtonPressed","style","background","physicalKeyboardHighlightBgColor","color","physicalKeyboardHighlightTextColor","physicalKeyboardHighlightPress","physicalKeyboardHighlightPressUsePointerEvents","onpointerdown","physicalKeyboardHighlightPressUseClick","click","handleButtonClicked","removeAttribute","onpointerup","keyId","code","keyCodeToKey","keyCode","CandidateBox","utilities","pageSize","layoutCandidatesPageSize","candidateBoxElement","remove","pageIndex","candidateValue","targetElement","onSelect","candidateListPages","chunkArray","renderPage","nbPages","onItemSelected","selectedCandidate","e","destroy","document","createElement","className","candidateListULElement","forEach","candidateListItem","candidateListLIElement","getMouseEvent","mouseEvent","MouseEvent","textContent","onclick","appendChild","isPrevBtnElementActive","prevBtnElement","classList","add","isNextBtnElementActive","nextBtnElement","prepend","SimpleKeyboard","selectorOrOptions","keyboardOptions","keyboardDOMClass","keyboardDOM","querySelector","HTMLDivElement","warn","Error","caretPositionEnd","name","initCallback","modules","baseDOMClasses","keyboardClasses","filter","DOMClass","handleParams","layoutName","theme","preventMouseDownDefault","enableLayoutCandidates","excludeFromLayout","keyboardPluginClasses","defaultName","buttonElements","currentInstanceName","camelCase","allKeyboardInstances","keyboardInstanceNames","keys","isFirstKeyboardInstance","physicalKeyboard","candidateBox","render","loadModules","endPosition","layoutCandidatesObj","layoutCandidates","layoutCandidatesCaseSensitiveMatch","layoutCandidate","inputSubstr","regexp","RegExp","escapeRegex","matchAll","candidateKey","sort","a","b","show","candidateStr","disableCandidateNormalization","normalize","getInput","initialCaretPosition","newInputSubstr","newInput","caretPositionDiff","newCaretPosition","setInput","onChange","onChangeAll","getAllInputs","getUpdatedInput","isStandardButton","activeInputElement","setSelectionRange","onKeyPress","inputPattern","inputPatternIsValid","handleMaxLength","newInputValue","syncInstanceInputs","target","getInputCandidates","showCandidatesBox","isMouseHold","preventDefault","stopMouseDownPropagation","stopPropagation","activeButtonClass","holdInteractionTimeout","clearTimeout","holdTimeout","setMouseHold","disableButtonHold","setTimeout","getMouseHold","handleButtonHold","preventMouseUpDefault","stopMouseUpPropagation","contains","recurseButtons","buttonElement","onKeyReleased","replaceInput","skipSync","rtl","inputWithoutRTLControl","changedOptions","onSetOptions","newOptions","optionName","JSON","stringify","keyboardRowsDOM","setAttribute","callback","buttons","classNameItem","buttonTheme","classNameFound","buttonThemeArray","push","class","isArray","filteredButtonArray","item","splice","buttonArr","inputVal","inputPatternRaw","didInputMatch","test","addEventListener","handleKeyUp","handleKeyDown","handleMouseUp","handleTouchEnd","handleSelect","handleSelectionChange","caretEventHandler","physicalKeyboardHighlight","handleHighlightKeyUp","handleHighlightKeyDown","targetTagName","tagName","isKeyboard","path","some","hasAttribute","type","disableCaretPositioning","selectionStart","selectionEnd","getRtlOffset","fn","removeEventListener","ontouchend","ontouchcancel","onmouseup","onpointercancel","ontouchstart","onmousedown","resetRows","innerHTML","initialized","buttonClasses","themeObj","themeObjClasses","buttonAttributes","attrObj","attribute","processAutoTouchEvents","disableContextualWindow","oncontextmenu","autoUseTouchEvents","useTouchEvents","setEventListeners","onInit","isTouchDevice","onTouchDeviceDetected","beforeFirstRender","pointerEventsSupported","useMouseEvents","beforeRender","onRender","onModulesLoaded","KeyboardModule","keyboardModule","init","rowDOM","rowIndex","containerStartIndexes","containerEndIndexes","rowDOMArray","from","children","removedElements","startIndex","arrIndex","endIndex","updated_startIndex","updated_endIndex","containerDOM","containerUID","containedElements","element","layoutClass","layout","default","shift","useTouchEventsClass","disableRowButtonContainers","getKeyboardClassString","row","rIndex","rowArray","bIndex","buttonHasContainerStart","buttonHasContainerEnd","fctBtnClass","getButtonClass","buttonDisplayName","getButtonDisplayName","buttonType","useButtonTag","getButtonThemeClasses","setDOMButtonAttributes","handleButtonMouseDown","handleButtonMouseUp","buttonUID","buttonSpanDOM","parseRowDOMContainers","undefined","handleKeyboardContainerMouseDown"],"mappings":"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","file":"index.modern.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SimpleKeyboard\"] = factory();\n\telse\n\t\troot[\"SimpleKeyboard\"] = factory();\n})(this, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { KeyboardInput } from \"./../interfaces\";\r\nimport { KeyboardOptions, UtilitiesParams } from \"../interfaces\";\r\n\r\n/**\r\n * Utility Service\r\n */\r\nclass Utilities {\r\n  getOptions: () => KeyboardOptions;\r\n  getCaretPosition: () => number | null;\r\n  getCaretPositionEnd: () => number | null;\r\n  dispatch: any;\r\n  maxLengthReached!: boolean;\r\n\r\n  /**\r\n   * Creates an instance of the Utility service\r\n   */\r\n  constructor({\r\n    getOptions,\r\n    getCaretPosition,\r\n    getCaretPositionEnd,\r\n    dispatch,\r\n  }: UtilitiesParams) {\r\n    this.getOptions = getOptions;\r\n    this.getCaretPosition = getCaretPosition;\r\n    this.getCaretPositionEnd = getCaretPositionEnd;\r\n    this.dispatch = dispatch;\r\n\r\n    /**\r\n     * Bindings\r\n     */\r\n    Utilities.bindMethods(Utilities, this);\r\n  }\r\n\r\n  /**\r\n   * Retrieve button type\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @return {string} The button type\r\n   */\r\n  getButtonType(button: string): string {\r\n    return button.includes(\"{\") && button.includes(\"}\") && button !== \"{//}\"\r\n      ? \"functionBtn\"\r\n      : \"standardBtn\";\r\n  }\r\n\r\n  /**\r\n   * Adds default classes to a given button\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @return {string} The classes to be added to the button\r\n   */\r\n  getButtonClass(button: string): string {\r\n    const buttonTypeClass = this.getButtonType(button);\r\n    const buttonWithoutBraces = button.replace(\"{\", \"\").replace(\"}\", \"\");\r\n    let buttonNormalized = \"\";\r\n\r\n    if (buttonTypeClass !== \"standardBtn\")\r\n      buttonNormalized = ` hg-button-${buttonWithoutBraces}`;\r\n\r\n    return `hg-${buttonTypeClass}${buttonNormalized}`;\r\n  }\r\n\r\n  /**\r\n   * Default button display labels\r\n   */\r\n  getDefaultDiplay() {\r\n    return {\r\n      \"{bksp}\": \"backspace\",\r\n      \"{backspace}\": \"backspace\",\r\n      \"{enter}\": \"< enter\",\r\n      \"{shift}\": \"shift\",\r\n      \"{shiftleft}\": \"shift\",\r\n      \"{shiftright}\": \"shift\",\r\n      \"{alt}\": \"alt\",\r\n      \"{s}\": \"shift\",\r\n      \"{tab}\": \"tab\",\r\n      \"{lock}\": \"caps\",\r\n      \"{capslock}\": \"caps\",\r\n      \"{accept}\": \"Submit\",\r\n      \"{space}\": \" \",\r\n      \"{//}\": \" \",\r\n      \"{esc}\": \"esc\",\r\n      \"{escape}\": \"esc\",\r\n      \"{f1}\": \"f1\",\r\n      \"{f2}\": \"f2\",\r\n      \"{f3}\": \"f3\",\r\n      \"{f4}\": \"f4\",\r\n      \"{f5}\": \"f5\",\r\n      \"{f6}\": \"f6\",\r\n      \"{f7}\": \"f7\",\r\n      \"{f8}\": \"f8\",\r\n      \"{f9}\": \"f9\",\r\n      \"{f10}\": \"f10\",\r\n      \"{f11}\": \"f11\",\r\n      \"{f12}\": \"f12\",\r\n      \"{numpaddivide}\": \"/\",\r\n      \"{numlock}\": \"lock\",\r\n      \"{arrowup}\": \"↑\",\r\n      \"{arrowleft}\": \"←\",\r\n      \"{arrowdown}\": \"↓\",\r\n      \"{arrowright}\": \"→\",\r\n      \"{prtscr}\": \"print\",\r\n      \"{scrolllock}\": \"scroll\",\r\n      \"{pause}\": \"pause\",\r\n      \"{insert}\": \"ins\",\r\n      \"{home}\": \"home\",\r\n      \"{pageup}\": \"up\",\r\n      \"{delete}\": \"del\",\r\n      \"{forwarddelete}\": \"del\",\r\n      \"{end}\": \"end\",\r\n      \"{pagedown}\": \"down\",\r\n      \"{numpadmultiply}\": \"*\",\r\n      \"{numpadsubtract}\": \"-\",\r\n      \"{numpadadd}\": \"+\",\r\n      \"{numpadenter}\": \"enter\",\r\n      \"{period}\": \".\",\r\n      \"{numpaddecimal}\": \".\",\r\n      \"{numpad0}\": \"0\",\r\n      \"{numpad1}\": \"1\",\r\n      \"{numpad2}\": \"2\",\r\n      \"{numpad3}\": \"3\",\r\n      \"{numpad4}\": \"4\",\r\n      \"{numpad5}\": \"5\",\r\n      \"{numpad6}\": \"6\",\r\n      \"{numpad7}\": \"7\",\r\n      \"{numpad8}\": \"8\",\r\n      \"{numpad9}\": \"9\",\r\n    };\r\n  }\r\n  /**\r\n   * Returns the display (label) name for a given button\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @param  {object} display The provided display option\r\n   * @param  {boolean} mergeDisplay Whether the provided param value should be merged with the default one.\r\n   */\r\n  getButtonDisplayName(\r\n    button: string,\r\n    display: KeyboardOptions[\"display\"],\r\n    mergeDisplay: boolean\r\n  ) {\r\n    if (mergeDisplay) {\r\n      display = Object.assign({}, this.getDefaultDiplay(), display);\r\n    } else {\r\n      display = display || this.getDefaultDiplay();\r\n    }\r\n\r\n    return display[button] || button;\r\n  }\r\n\r\n  /**\r\n   * Returns the updated input resulting from clicking a given button\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @param  {string} input The input string\r\n   * @param  {number} caretPos The cursor's current position\r\n   * @param  {number} caretPosEnd The cursor's current end position\r\n   * @param  {boolean} moveCaret Whether to update simple-keyboard's cursor\r\n   */\r\n  getUpdatedInput(\r\n    button: string,\r\n    input: string,\r\n    caretPos: number,\r\n    caretPosEnd = caretPos,\r\n    moveCaret = false\r\n  ) {\r\n    const options = this.getOptions();\r\n    const commonParams: [number, number, boolean] = [\r\n      caretPos,\r\n      caretPosEnd,\r\n      moveCaret,\r\n    ];\r\n\r\n    let output = input;\r\n\r\n    if (\r\n      (button === \"{bksp}\" || button === \"{backspace}\") &&\r\n      output.length > 0\r\n    ) {\r\n      output = this.removeAt(output, ...commonParams);\r\n    } else if (\r\n      (button === \"{delete}\" || button === \"{forwarddelete}\") &&\r\n      output.length > 0\r\n    ) {\r\n      output = this.removeForwardsAt(output, ...commonParams);\r\n    } else if (button === \"{space}\")\r\n      output = this.addStringAt(output, \" \", ...commonParams);\r\n    else if (\r\n      button === \"{tab}\" &&\r\n      !(\r\n        typeof options.tabCharOnTab === \"boolean\" &&\r\n        options.tabCharOnTab === false\r\n      )\r\n    ) {\r\n      output = this.addStringAt(output, \"\\t\", ...commonParams);\r\n    } else if (\r\n      (button === \"{enter}\" || button === \"{numpadenter}\") &&\r\n      options.newLineOnEnter\r\n    )\r\n      output = this.addStringAt(output, \"\\n\", ...commonParams);\r\n    else if (\r\n      button.includes(\"numpad\") &&\r\n      Number.isInteger(Number(button[button.length - 2]))\r\n    ) {\r\n      output = this.addStringAt(\r\n        output,\r\n        button[button.length - 2],\r\n        ...commonParams\r\n      );\r\n    } else if (button === \"{numpaddivide}\")\r\n      output = this.addStringAt(output, \"/\", ...commonParams);\r\n    else if (button === \"{numpadmultiply}\")\r\n      output = this.addStringAt(output, \"*\", ...commonParams);\r\n    else if (button === \"{numpadsubtract}\")\r\n      output = this.addStringAt(output, \"-\", ...commonParams);\r\n    else if (button === \"{numpadadd}\")\r\n      output = this.addStringAt(output, \"+\", ...commonParams);\r\n    else if (button === \"{numpaddecimal}\")\r\n      output = this.addStringAt(output, \".\", ...commonParams);\r\n    else if (button === \"{\" || button === \"}\")\r\n      output = this.addStringAt(output, button, ...commonParams);\r\n    else if (!button.includes(\"{\") && !button.includes(\"}\"))\r\n      output = this.addStringAt(output, button, ...commonParams);\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Moves the cursor position by a given amount\r\n   *\r\n   * @param  {number} length Represents by how many characters the input should be moved\r\n   * @param  {boolean} minus Whether the cursor should be moved to the left or not.\r\n   */\r\n  updateCaretPos(length: number, minus = false) {\r\n    const newCaretPos = this.updateCaretPosAction(length, minus);\r\n\r\n    this.dispatch((instance: any) => {\r\n      instance.setCaretPosition(newCaretPos);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Action method of updateCaretPos\r\n   *\r\n   * @param  {number} length Represents by how many characters the input should be moved\r\n   * @param  {boolean} minus Whether the cursor should be moved to the left or not.\r\n   */\r\n  updateCaretPosAction(length: number, minus = false) {\r\n    const options = this.getOptions();\r\n    let caretPosition = this.getCaretPosition();\r\n\r\n    if (caretPosition != null) {\r\n      if (minus) {\r\n        if (caretPosition > 0) caretPosition = caretPosition - length;\r\n      } else {\r\n        caretPosition = caretPosition + length;\r\n      }\r\n    }\r\n\r\n    if (options.debug) {\r\n      console.log(\"Caret at:\", caretPosition);\r\n    }\r\n\r\n    return caretPosition;\r\n  }\r\n\r\n  /**\r\n   * Adds a string to the input at a given position\r\n   *\r\n   * @param  {string} source The source input\r\n   * @param  {string} str The string to add\r\n   * @param  {number} position The (cursor) position where the string should be added\r\n   * @param  {boolean} moveCaret Whether to update simple-keyboard's cursor\r\n   */\r\n  addStringAt(\r\n    source: string,\r\n    str: string,\r\n    position = source.length,\r\n    positionEnd = source.length,\r\n    moveCaret = false\r\n  ) {\r\n    let output;\r\n\r\n    if (!position && position !== 0) {\r\n      output = source + str;\r\n    } else {\r\n      output = [source.slice(0, position), str, source.slice(positionEnd)].join(\r\n        \"\"\r\n      );\r\n\r\n      /**\r\n       * Avoid caret position change when maxLength is set\r\n       */\r\n      if (!this.isMaxLengthReached()) {\r\n        if (moveCaret) this.updateCaretPos(str.length);\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Check whether the button is a standard button\r\n   */\r\n  isStandardButton = (button: string) =>\r\n    button && !(button[0] === \"{\" && button[button.length - 1] === \"}\");\r\n\r\n  /**\r\n   * Removes an amount of characters before a given position\r\n   *\r\n   * @param  {string} source The source input\r\n   * @param  {number} position The (cursor) position from where the characters should be removed\r\n   * @param  {boolean} moveCaret Whether to update simple-keyboard's cursor\r\n   */\r\n  removeAt(\r\n    source: string,\r\n    position = source.length,\r\n    positionEnd = source.length,\r\n    moveCaret = false\r\n  ) {\r\n    if (position === 0 && positionEnd === 0) {\r\n      return source;\r\n    }\r\n\r\n    let output;\r\n\r\n    if (position === positionEnd) {\r\n      let prevTwoChars;\r\n      let emojiMatched;\r\n      const emojiMatchedReg = /([\\uD800-\\uDBFF][\\uDC00-\\uDFFF])/g;\r\n\r\n      /**\r\n       * Emojis are made out of two characters, so we must take a custom approach to trim them.\r\n       * For more info: https://mathiasbynens.be/notes/javascript-unicode\r\n       */\r\n      if (position && position >= 0) {\r\n        prevTwoChars = source.substring(position - 2, position);\r\n        emojiMatched = prevTwoChars.match(emojiMatchedReg);\r\n\r\n        if (emojiMatched) {\r\n          output = source.substr(0, position - 2) + source.substr(position);\r\n          if (moveCaret) this.updateCaretPos(2, true);\r\n        } else {\r\n          output = source.substr(0, position - 1) + source.substr(position);\r\n          if (moveCaret) this.updateCaretPos(1, true);\r\n        }\r\n      } else {\r\n        prevTwoChars = source.slice(-2);\r\n        emojiMatched = prevTwoChars.match(emojiMatchedReg);\r\n\r\n        if (emojiMatched) {\r\n          output = source.slice(0, -2);\r\n          if (moveCaret) this.updateCaretPos(2, true);\r\n        } else {\r\n          output = source.slice(0, -1);\r\n          if (moveCaret) this.updateCaretPos(1, true);\r\n        }\r\n      }\r\n    } else {\r\n      output = source.slice(0, position) + source.slice(positionEnd);\r\n      if (moveCaret) {\r\n        this.dispatch((instance: any) => {\r\n          instance.setCaretPosition(position);\r\n        });\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Removes an amount of characters after a given position\r\n   *\r\n   * @param  {string} source The source input\r\n   * @param  {number} position The (cursor) position from where the characters should be removed\r\n   */\r\n  removeForwardsAt(\r\n    source: string,\r\n    position: number = source.length,\r\n    positionEnd: number = source.length,\r\n    moveCaret = false\r\n  ) {\r\n    if (!source?.length || position === null) {\r\n      return source;\r\n    }\r\n\r\n    let output;\r\n\r\n    if (position === positionEnd) {\r\n      const emojiMatchedReg = /([\\uD800-\\uDBFF][\\uDC00-\\uDFFF])/g;\r\n\r\n      /**\r\n       * Emojis are made out of two characters, so we must take a custom approach to trim them.\r\n       * For more info: https://mathiasbynens.be/notes/javascript-unicode\r\n       */\r\n      const nextTwoChars = source.substring(position, position + 2);\r\n      const emojiMatched = nextTwoChars.match(emojiMatchedReg);\r\n\r\n      if (emojiMatched) {\r\n        output = source.substr(0, position) + source.substr(position + 2);\r\n      } else {\r\n        output = source.substr(0, position) + source.substr(position + 1);\r\n      }\r\n    } else {\r\n      output = source.slice(0, position) + source.slice(positionEnd);\r\n      if (moveCaret) {\r\n        this.dispatch((instance: any) => {\r\n          instance.setCaretPosition(position);\r\n        });\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Determines whether the maxLength has been reached. This function is called when the maxLength option it set.\r\n   *\r\n   * @param  {object} inputObj\r\n   * @param  {string} updatedInput\r\n   */\r\n  handleMaxLength(inputObj: KeyboardInput, updatedInput: string) {\r\n    const options = this.getOptions();\r\n    const maxLength = options.maxLength;\r\n    const currentInput = inputObj[options.inputName || \"default\"];\r\n    const condition = updatedInput.length - 1 >= maxLength;\r\n\r\n    if (\r\n      /**\r\n       * If pressing this button won't add more characters\r\n       * We exit out of this limiter function\r\n       */\r\n      updatedInput.length <= currentInput.length\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (Number.isInteger(maxLength)) {\r\n      if (options.debug) {\r\n        console.log(\"maxLength (num) reached:\", condition);\r\n      }\r\n\r\n      if (condition) {\r\n        /**\r\n         * @type {boolean} Boolean value that shows whether maxLength has been reached\r\n         */\r\n        this.maxLengthReached = true;\r\n        return true;\r\n      } else {\r\n        this.maxLengthReached = false;\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (typeof maxLength === \"object\") {\r\n      const condition =\r\n        updatedInput.length - 1 >= maxLength[options.inputName || \"default\"];\r\n\r\n      if (options.debug) {\r\n        console.log(\"maxLength (obj) reached:\", condition);\r\n      }\r\n\r\n      if (condition) {\r\n        this.maxLengthReached = true;\r\n        return true;\r\n      } else {\r\n        this.maxLengthReached = false;\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the current value of maxLengthReached\r\n   */\r\n  isMaxLengthReached() {\r\n    return Boolean(this.maxLengthReached);\r\n  }\r\n\r\n  /**\r\n   * Determines whether a touch device is being used\r\n   */\r\n  isTouchDevice() {\r\n    return \"ontouchstart\" in window || navigator.maxTouchPoints;\r\n  }\r\n\r\n  /**\r\n   * Determines whether pointer events are supported\r\n   */\r\n  pointerEventsSupported() {\r\n    return !!window.PointerEvent;\r\n  }\r\n\r\n  /**\r\n   * Bind all methods in a given class\r\n   */\r\n\r\n  static bindMethods(myClass: any, instance: any) {\r\n    // eslint-disable-next-line no-unused-vars\r\n    for (const myMethod of Object.getOwnPropertyNames(myClass.prototype)) {\r\n      const excludeMethod =\r\n        myMethod === \"constructor\" || myMethod === \"bindMethods\";\r\n      if (!excludeMethod) {\r\n        instance[myMethod] = instance[myMethod].bind(instance);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms an arbitrary string to camelCase\r\n   *\r\n   * @param  {string} str The string to transform.\r\n   */\r\n  camelCase(str: string): string {\r\n    if (!str) return \"\";\r\n\r\n    return str\r\n      .toLowerCase()\r\n      .trim()\r\n      .split(/[.\\-_\\s]/g)\r\n      .reduce((str, word) =>\r\n        word.length ? str + word[0].toUpperCase() + word.slice(1) : str\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Split array into chunks\r\n   */\r\n  chunkArray<T>(arr: T[], size: number): T[][] {\r\n    return [...Array(Math.ceil(arr.length / size))].map((_, i) =>\r\n      arr.slice(size * i, size + size * i)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Escape regex input\r\n   */\r\n  escapeRegex(str: string) {\r\n    return str.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\r\n  }\r\n\r\n  /**\r\n   * Calculate caret position offset when using rtl option\r\n   */\r\n  getRtlOffset(index: number, input: string) {\r\n    let newIndex = index;\r\n    const startMarkerIndex = input.indexOf(\"\\u202B\");\r\n    const endMarkerIndex = input.indexOf(\"\\u202C\");\r\n\r\n    if(startMarkerIndex < index && startMarkerIndex != -1){ newIndex--; }\r\n    if(endMarkerIndex < index && startMarkerIndex != -1){ newIndex--; }\r\n\r\n    return newIndex < 0 ? 0 : newIndex;\r\n  }\r\n\r\n  /**\r\n   * Reusable empty function\r\n   */\r\n  static noop = () => {};\r\n}\r\n\r\nexport default Utilities;\r\n","import { KeyboardOptions, PhysicalKeyboardParams } from \"../interfaces\";\r\nimport Utilities from \"../services/Utilities\";\r\n\r\n/**\r\n * Physical Keyboard Service\r\n */\r\nclass PhysicalKeyboard {\r\n  getOptions: () => KeyboardOptions;\r\n  dispatch: any;\r\n\r\n  /**\r\n   * Creates an instance of the PhysicalKeyboard service\r\n   */\r\n  constructor({ dispatch, getOptions }: PhysicalKeyboardParams) {\r\n    /**\r\n     * @type {object} A simple-keyboard instance\r\n     */\r\n    this.dispatch = dispatch;\r\n    this.getOptions = getOptions;\r\n\r\n    /**\r\n     * Bindings\r\n     */\r\n    Utilities.bindMethods(PhysicalKeyboard, this);\r\n  }\r\n\r\n  handleHighlightKeyDown(event: KeyboardEvent) {\r\n    const options = this.getOptions();\r\n    const buttonPressed = this.getSimpleKeyboardLayoutKey(event);\r\n\r\n    this.dispatch((instance: any) => {\r\n      const standardButtonPressed = instance.getButtonElement(buttonPressed);\r\n      const functionButtonPressed = instance.getButtonElement(\r\n        `{${buttonPressed}}`\r\n      );\r\n      let buttonDOM;\r\n      let buttonName;\r\n\r\n      if (standardButtonPressed) {\r\n        buttonDOM = standardButtonPressed;\r\n        buttonName = buttonPressed;\r\n      } else if (functionButtonPressed) {\r\n        buttonDOM = functionButtonPressed;\r\n        buttonName = `{${buttonPressed}}`;\r\n      } else {\r\n        return;\r\n      }\r\n\r\n      if (buttonDOM) {\r\n        buttonDOM.style.background =\r\n          options.physicalKeyboardHighlightBgColor || \"#dadce4\";\r\n        buttonDOM.style.color =\r\n          options.physicalKeyboardHighlightTextColor || \"black\";\r\n\r\n        if (options.physicalKeyboardHighlightPress) {\r\n          if (options.physicalKeyboardHighlightPressUsePointerEvents) {\r\n            buttonDOM.onpointerdown();\r\n          } else if (options.physicalKeyboardHighlightPressUseClick) {\r\n            buttonDOM.click();\r\n          } else {\r\n            instance.handleButtonClicked(buttonName, event);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  handleHighlightKeyUp(event: KeyboardEvent) {\r\n    const options = this.getOptions();\r\n    const buttonPressed = this.getSimpleKeyboardLayoutKey(event);\r\n\r\n    this.dispatch((instance: any) => {\r\n      const buttonDOM =\r\n        instance.getButtonElement(buttonPressed) ||\r\n        instance.getButtonElement(`{${buttonPressed}}`);\r\n\r\n      if (buttonDOM && buttonDOM.removeAttribute) {\r\n        buttonDOM.removeAttribute(\"style\");\r\n        if (options.physicalKeyboardHighlightPressUsePointerEvents) {\r\n          buttonDOM.onpointerup();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Transforms a KeyboardEvent's \"key.code\" string into a simple-keyboard layout format\r\n   * @param  {object} event The KeyboardEvent\r\n   */\r\n  getSimpleKeyboardLayoutKey(event: KeyboardEvent) {\r\n    let output = \"\";\r\n    const keyId = event.code || event.key || this.keyCodeToKey(event?.keyCode);\r\n\r\n    if (\r\n      keyId?.includes(\"Numpad\") ||\r\n      keyId?.includes(\"Shift\") ||\r\n      keyId?.includes(\"Space\") ||\r\n      keyId?.includes(\"Backspace\") ||\r\n      keyId?.includes(\"Control\") ||\r\n      keyId?.includes(\"Alt\") ||\r\n      keyId?.includes(\"Meta\")\r\n    ) {\r\n      output = event.code || \"\";\r\n    } else {\r\n      output = event.key || this.keyCodeToKey(event?.keyCode) || \"\";\r\n    }\r\n\r\n    return output.length > 1 ? output?.toLowerCase() : output;\r\n  }\r\n\r\n  /**\r\n   * Retrieve key from keyCode\r\n   */\r\n  keyCodeToKey(keyCode: number) {\r\n    return {\r\n      8: \"Backspace\",\r\n      9: \"Tab\",\r\n      13: \"Enter\",\r\n      16: \"Shift\",\r\n      17: \"Ctrl\",\r\n      18: \"Alt\",\r\n      19: \"Pause\",\r\n      20: \"CapsLock\",\r\n      27: \"Esc\",\r\n      32: \"Space\",\r\n      33: \"PageUp\",\r\n      34: \"PageDown\",\r\n      35: \"End\",\r\n      36: \"Home\",\r\n      37: \"ArrowLeft\",\r\n      38: \"ArrowUp\",\r\n      39: \"ArrowRight\",\r\n      40: \"ArrowDown\",\r\n      45: \"Insert\",\r\n      46: \"Delete\",\r\n      48: \"0\",\r\n      49: \"1\",\r\n      50: \"2\",\r\n      51: \"3\",\r\n      52: \"4\",\r\n      53: \"5\",\r\n      54: \"6\",\r\n      55: \"7\",\r\n      56: \"8\",\r\n      57: \"9\",\r\n      65: \"A\",\r\n      66: \"B\",\r\n      67: \"C\",\r\n      68: \"D\",\r\n      69: \"E\",\r\n      70: \"F\",\r\n      71: \"G\",\r\n      72: \"H\",\r\n      73: \"I\",\r\n      74: \"J\",\r\n      75: \"K\",\r\n      76: \"L\",\r\n      77: \"M\",\r\n      78: \"N\",\r\n      79: \"O\",\r\n      80: \"P\",\r\n      81: \"Q\",\r\n      82: \"R\",\r\n      83: \"S\",\r\n      84: \"T\",\r\n      85: \"U\",\r\n      86: \"V\",\r\n      87: \"W\",\r\n      88: \"X\",\r\n      89: \"Y\",\r\n      90: \"Z\",\r\n      91: \"Meta\",\r\n      96: \"Numpad0\",\r\n      97: \"Numpad1\",\r\n      98: \"Numpad2\",\r\n      99: \"Numpad3\",\r\n      100: \"Numpad4\",\r\n      101: \"Numpad5\",\r\n      102: \"Numpad6\",\r\n      103: \"Numpad7\",\r\n      104: \"Numpad8\",\r\n      105: \"Numpad9\",\r\n      106: \"NumpadMultiply\",\r\n      107: \"NumpadAdd\",\r\n      109: \"NumpadSubtract\",\r\n      110: \"NumpadDecimal\",\r\n      111: \"NumpadDivide\",\r\n      112: \"F1\",\r\n      113: \"F2\",\r\n      114: \"F3\",\r\n      115: \"F4\",\r\n      116: \"F5\",\r\n      117: \"F6\",\r\n      118: \"F7\",\r\n      119: \"F8\",\r\n      120: \"F9\",\r\n      121: \"F10\",\r\n      122: \"F11\",\r\n      123: \"F12\",\r\n      144: \"NumLock\",\r\n      145: \"ScrollLock\",\r\n      186: \";\",\r\n      187: \"=\",\r\n      188: \",\",\r\n      189: \"-\",\r\n      190: \".\",\r\n      191: \"/\",\r\n      192: \"`\",\r\n      219: \"[\",\r\n      220: \"\\\\\",\r\n      221: \"]\",\r\n      222: \"'\",\r\n    }[keyCode];\r\n  }\r\n}\r\n\r\nexport default PhysicalKeyboard;\r\n","import \"./css/CandidateBox.css\";\r\n\r\nimport Utilities from \"../services/Utilities\";\r\nimport {\r\n  CandidateBoxParams,\r\n  CandidateBoxRenderParams,\r\n  CandidateBoxShowParams,\r\n  KeyboardOptions,\r\n} from \"./../interfaces\";\r\n\r\nclass CandidateBox {\r\n  utilities: Utilities;\r\n  options: KeyboardOptions;\r\n  candidateBoxElement!: HTMLDivElement;\r\n  pageIndex = 0;\r\n  pageSize;\r\n\r\n  constructor({ utilities, options }: CandidateBoxParams) {\r\n    this.utilities = utilities;\r\n    this.options = options;\r\n    Utilities.bindMethods(CandidateBox, this);\r\n    this.pageSize = this.utilities.getOptions().layoutCandidatesPageSize || 5;\r\n  }\r\n\r\n  destroy() {\r\n    if (this.candidateBoxElement) {\r\n      this.candidateBoxElement.remove();\r\n      this.pageIndex = 0;\r\n    }\r\n  }\r\n\r\n  show({\r\n    candidateValue,\r\n    targetElement,\r\n    onSelect,\r\n  }: CandidateBoxShowParams): void {\r\n    if (!candidateValue || !candidateValue.length) {\r\n      return;\r\n    }\r\n\r\n    const candidateListPages = this.utilities.chunkArray(\r\n      candidateValue.split(\" \"),\r\n      this.pageSize\r\n    );\r\n\r\n    this.renderPage({\r\n      candidateListPages,\r\n      targetElement,\r\n      pageIndex: this.pageIndex,\r\n      nbPages: candidateListPages.length,\r\n      onItemSelected: (selectedCandidate: string, e: MouseEvent) => {\r\n        onSelect(selectedCandidate, e);\r\n        this.destroy();\r\n      },\r\n    });\r\n  }\r\n\r\n  renderPage({\r\n    candidateListPages,\r\n    targetElement,\r\n    pageIndex,\r\n    nbPages,\r\n    onItemSelected,\r\n  }: CandidateBoxRenderParams) {\r\n    // Remove current candidate box, if any\r\n    this.candidateBoxElement?.remove();\r\n\r\n    // Create candidate box element\r\n    this.candidateBoxElement = document.createElement(\"div\");\r\n    this.candidateBoxElement.className = \"hg-candidate-box\";\r\n\r\n    // Candidate box list\r\n    const candidateListULElement = document.createElement(\"ul\");\r\n    candidateListULElement.className = \"hg-candidate-box-list\";\r\n\r\n    // Create Candidate box list items\r\n    candidateListPages[pageIndex].forEach((candidateListItem) => {\r\n      const candidateListLIElement = document.createElement(\"li\");\r\n      const getMouseEvent = () => {\r\n        const mouseEvent = new MouseEvent(\"click\");\r\n        Object.defineProperty(mouseEvent, \"target\", {\r\n          value: candidateListLIElement,\r\n        });\r\n        return mouseEvent;\r\n      };\r\n\r\n      candidateListLIElement.className = \"hg-candidate-box-list-item\";\r\n      candidateListLIElement.textContent = this.options.display?.[candidateListItem] || candidateListItem;\r\n      candidateListLIElement.onclick = (e = getMouseEvent()) =>\r\n        onItemSelected(candidateListItem, e);\r\n\r\n      // Append list item to ul\r\n      candidateListULElement.appendChild(candidateListLIElement);\r\n    });\r\n\r\n    // Add previous button\r\n    const isPrevBtnElementActive = pageIndex > 0;\r\n    const prevBtnElement = document.createElement(\"div\");\r\n    prevBtnElement.classList.add(\"hg-candidate-box-prev\");\r\n    isPrevBtnElementActive &&\r\n      prevBtnElement.classList.add(\"hg-candidate-box-btn-active\");\r\n    prevBtnElement.onclick = () => {\r\n      if (!isPrevBtnElementActive) return;\r\n      this.renderPage({\r\n        candidateListPages,\r\n        targetElement,\r\n        pageIndex: pageIndex - 1,\r\n        nbPages,\r\n        onItemSelected,\r\n      });\r\n    };\r\n    this.candidateBoxElement.appendChild(prevBtnElement);\r\n\r\n    // Add elements to container\r\n    this.candidateBoxElement.appendChild(candidateListULElement);\r\n\r\n    // Add next button\r\n    const isNextBtnElementActive = pageIndex < nbPages - 1;\r\n    const nextBtnElement = document.createElement(\"div\");\r\n    nextBtnElement.classList.add(\"hg-candidate-box-next\");\r\n    isNextBtnElementActive &&\r\n      nextBtnElement.classList.add(\"hg-candidate-box-btn-active\");\r\n\r\n    nextBtnElement.onclick = () => {\r\n      if (!isNextBtnElementActive) return;\r\n      this.renderPage({\r\n        candidateListPages,\r\n        targetElement,\r\n        pageIndex: pageIndex + 1,\r\n        nbPages,\r\n        onItemSelected,\r\n      });\r\n    };\r\n    this.candidateBoxElement.appendChild(nextBtnElement);\r\n\r\n    // Append candidate box to target element\r\n    targetElement.prepend(this.candidateBoxElement);\r\n  }\r\n}\r\n\r\nexport default CandidateBox;\r\n","import \"./css/Keyboard.css\";\r\n\r\n// Services\r\nimport { getDefaultLayout } from \"../services/KeyboardLayout\";\r\nimport PhysicalKeyboard from \"../services/PhysicalKeyboard\";\r\nimport Utilities from \"../services/Utilities\";\r\nimport {\r\n  KeyboardOptions,\r\n  KeyboardInput,\r\n  KeyboardButtonElements,\r\n  KeyboardHandlerEvent,\r\n  KeyboardElement,\r\n} from \"../interfaces\";\r\nimport CandidateBox from \"./CandidateBox\";\r\n\r\n/**\r\n * Root class for simple-keyboard.\r\n * This class:\r\n * - Parses the options\r\n * - Renders the rows and buttons\r\n * - Handles button functionality\r\n */\r\nclass SimpleKeyboard {\r\n  input!: KeyboardInput;\r\n  options!: KeyboardOptions;\r\n  utilities: any;\r\n  caretPosition!: number | null;\r\n  caretPositionEnd!: number | null;\r\n  keyboardDOM!: KeyboardElement;\r\n  keyboardPluginClasses!: string;\r\n  keyboardDOMClass!: string;\r\n  buttonElements!: KeyboardButtonElements;\r\n  currentInstanceName!: string;\r\n  allKeyboardInstances!: { [key: string]: SimpleKeyboard };\r\n  keyboardInstanceNames!: string[];\r\n  isFirstKeyboardInstance!: boolean;\r\n  physicalKeyboard!: PhysicalKeyboard;\r\n  modules!: { [key: string]: any };\r\n  activeButtonClass!: string;\r\n  holdInteractionTimeout!: number;\r\n  holdTimeout!: number;\r\n  isMouseHold!: boolean;\r\n  initialized!: boolean;\r\n  candidateBox!: CandidateBox | null;\r\n  keyboardRowsDOM!: KeyboardElement;\r\n  defaultName = \"default\";\r\n  activeInputElement: HTMLInputElement | HTMLTextAreaElement | null = null;\r\n\r\n  /**\r\n   * Creates an instance of SimpleKeyboard\r\n   * @param {Array} params If first parameter is a string, it is considered the container class. The second parameter is then considered the options object. If first parameter is an object, it is considered the options object.\r\n   */\r\n  constructor(\r\n    selectorOrOptions?: string | HTMLDivElement | KeyboardOptions,\r\n    keyboardOptions?: KeyboardOptions\r\n  ) {\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    const {\r\n      keyboardDOMClass,\r\n      keyboardDOM,\r\n      options = {},\r\n    } = this.handleParams(selectorOrOptions, keyboardOptions);\r\n\r\n    /**\r\n     * Initializing Utilities\r\n     */\r\n    this.utilities = new Utilities({\r\n      getOptions: this.getOptions,\r\n      getCaretPosition: this.getCaretPosition,\r\n      getCaretPositionEnd: this.getCaretPositionEnd,\r\n      dispatch: this.dispatch,\r\n    });\r\n\r\n    /**\r\n     * Caret position\r\n     */\r\n    this.caretPosition = null;\r\n\r\n    /**\r\n     * Caret position end\r\n     */\r\n    this.caretPositionEnd = null;\r\n\r\n    /**\r\n     * Processing options\r\n     */\r\n    this.keyboardDOM = keyboardDOM;\r\n\r\n    /**\r\n     * @type {object}\r\n     * @property {object} layout Modify the keyboard layout.\r\n     * @property {string} layoutName Specifies which layout should be used.\r\n     * @property {object} display Replaces variable buttons (such as {bksp}) with a human-friendly name (e.g.: “backspace”).\r\n     * @property {boolean} mergeDisplay By default, when you set the display property, you replace the default one. This setting merges them instead.\r\n     * @property {string} theme A prop to add your own css classes to the keyboard wrapper. You can add multiple classes separated by a space.\r\n     * @property {array} buttonTheme A prop to add your own css classes to one or several buttons.\r\n     * @property {array} buttonAttributes A prop to add your own attributes to one or several buttons.\r\n     * @property {boolean} debug Runs a console.log every time a key is pressed. Displays the buttons pressed and the current input.\r\n     * @property {boolean} newLineOnEnter Specifies whether clicking the “ENTER” button will input a newline (\\n) or not.\r\n     * @property {boolean} tabCharOnTab Specifies whether clicking the “TAB” button will input a tab character (\\t) or not.\r\n     * @property {string} inputName Allows you to use a single simple-keyboard instance for several inputs.\r\n     * @property {number} maxLength Restrains all of simple-keyboard inputs to a certain length. This should be used in addition to the input element’s maxlengthattribute.\r\n     * @property {object} maxLength Restrains simple-keyboard’s individual inputs to a certain length. This should be used in addition to the input element’s maxlengthattribute.\r\n     * @property {boolean} syncInstanceInputs When set to true, this option synchronizes the internal input of every simple-keyboard instance.\r\n     * @property {boolean} physicalKeyboardHighlight Enable highlighting of keys pressed on physical keyboard.\r\n     * @property {boolean} physicalKeyboardHighlightPress Presses keys highlighted by physicalKeyboardHighlight\r\n     * @property {string} physicalKeyboardHighlightTextColor Define the text color that the physical keyboard highlighted key should have.\r\n     * @property {string} physicalKeyboardHighlightBgColor Define the background color that the physical keyboard highlighted key should have.\r\n     * @property {boolean} physicalKeyboardHighlightPressUseClick Whether physicalKeyboardHighlightPress should use clicks to trigger buttons.\r\n     * @property {boolean} physicalKeyboardHighlightPressUsePointerEvents Whether physicalKeyboardHighlightPress should use pointer events to trigger buttons.\r\n     * @property {boolean} preventMouseDownDefault Calling preventDefault for the mousedown events keeps the focus on the input.\r\n     * @property {boolean} preventMouseUpDefault Calling preventDefault for the mouseup events.\r\n     * @property {boolean} stopMouseDownPropagation Stops pointer down events on simple-keyboard buttons from bubbling to parent elements.\r\n     * @property {boolean} stopMouseUpPropagation Stops pointer up events on simple-keyboard buttons from bubbling to parent elements.\r\n     * @property {function(button: string):string} onKeyPress Executes the callback function on key press. Returns button layout name (i.e.: “{shift}”).\r\n     * @property {function(input: string):string} onChange Executes the callback function on input change. Returns the current input’s string.\r\n     * @property {function} onRender Executes the callback function every time simple-keyboard is rendered (e.g: when you change layouts).\r\n     * @property {function} onInit Executes the callback function once simple-keyboard is rendered for the first time (on initialization).\r\n     * @property {function(inputs: object):object} onChangeAll Executes the callback function on input change. Returns the input object with all defined inputs.\r\n     * @property {boolean} useButtonTag Render buttons as a button element instead of a div element.\r\n     * @property {boolean} disableCaretPositioning A prop to ensure characters are always be added/removed at the end of the string.\r\n     * @property {object} inputPattern Restrains input(s) change to the defined regular expression pattern.\r\n     * @property {boolean} useTouchEvents Instructs simple-keyboard to use touch events instead of click events.\r\n     * @property {boolean} autoUseTouchEvents Enable useTouchEvents automatically when touch device is detected.\r\n     * @property {boolean} useMouseEvents Opt out of PointerEvents handling, falling back to the prior mouse event logic.\r\n     * @property {function} destroy Clears keyboard listeners and DOM elements.\r\n     * @property {boolean} disableButtonHold Disable button hold action.\r\n     * @property {boolean} rtl Adds unicode right-to-left control characters to input return values.\r\n     * @property {function} onKeyReleased Executes the callback function on key release.\r\n     * @property {array} modules Module classes to be loaded by simple-keyboard.\r\n     * @property {boolean} enableLayoutCandidates Enable input method editor candidate list support.\r\n     * @property {object} excludeFromLayout Buttons to exclude from layout\r\n     * @property {number} layoutCandidatesPageSize Determines size of layout candidate list\r\n     * @property {boolean} layoutCandidatesCaseSensitiveMatch Determines whether layout candidate match should be case sensitive.\r\n     * @property {boolean} disableCandidateNormalization Disables the automatic normalization for selected layout candidates\r\n     */\r\n    this.options = {\r\n      layoutName: \"default\",\r\n      theme: \"hg-theme-default\",\r\n      inputName: \"default\",\r\n      preventMouseDownDefault: false,\r\n      enableLayoutCandidates: true,\r\n      excludeFromLayout: {},\r\n      ...options,\r\n    };\r\n\r\n    /**\r\n     * @type {object} Classes identifying loaded plugins\r\n     */\r\n    this.keyboardPluginClasses = \"\";\r\n\r\n    /**\r\n     * Bindings\r\n     */\r\n    Utilities.bindMethods(SimpleKeyboard, this);\r\n\r\n    /**\r\n     * simple-keyboard uses a non-persistent internal input to keep track of the entered string (the variable `keyboard.input`).\r\n     * This removes any dependency to input DOM elements. You can type and directly display the value in a div element, for example.\r\n     * @example\r\n     * // To get entered input\r\n     * const input = keyboard.getInput();\r\n     *\r\n     * // To clear entered input.\r\n     * keyboard.clearInput();\r\n     *\r\n     * @type {object}\r\n     * @property {object} default Default SimpleKeyboard internal input.\r\n     * @property {object} myInputName Example input that can be set through `options.inputName:\"myInputName\"`.\r\n     */\r\n    const { inputName = this.defaultName } = this.options;\r\n    this.input = {};\r\n    this.input[inputName] = \"\";\r\n\r\n    /**\r\n     * @type {string} DOM class of the keyboard wrapper, normally \"simple-keyboard\" by default.\r\n     */\r\n    this.keyboardDOMClass = keyboardDOMClass;\r\n\r\n    /**\r\n     * @type {object} Contains the DOM elements of every rendered button, the key being the button's layout name (e.g.: \"{enter}\").\r\n     */\r\n    this.buttonElements = {};\r\n\r\n    /**\r\n     * Simple-keyboard Instances\r\n     * This enables multiple simple-keyboard support with easier management\r\n     */\r\n    if (!window[\"SimpleKeyboardInstances\"])\r\n      window[\"SimpleKeyboardInstances\"] = {};\r\n\r\n    this.currentInstanceName = this.utilities.camelCase(this.keyboardDOMClass);\r\n    window[\"SimpleKeyboardInstances\"][this.currentInstanceName] = this;\r\n\r\n    /**\r\n     * Instance vars\r\n     */\r\n    this.allKeyboardInstances = window[\"SimpleKeyboardInstances\"];\r\n    this.keyboardInstanceNames = Object.keys(window[\"SimpleKeyboardInstances\"]);\r\n    this.isFirstKeyboardInstance =\r\n      this.keyboardInstanceNames[0] === this.currentInstanceName;\r\n\r\n    /**\r\n     * Physical Keyboard support\r\n     */\r\n    this.physicalKeyboard = new PhysicalKeyboard({\r\n      dispatch: this.dispatch,\r\n      getOptions: this.getOptions,\r\n    });\r\n\r\n    /**\r\n     * Initializing CandidateBox\r\n     */\r\n    this.candidateBox = this.options.enableLayoutCandidates\r\n      ? new CandidateBox({\r\n          utilities: this.utilities,\r\n          options: this.options,\r\n        })\r\n      : null;\r\n\r\n    /**\r\n     * Rendering keyboard\r\n     */\r\n    if (this.keyboardDOM) this.render();\r\n    else {\r\n      console.warn(`\".${keyboardDOMClass}\" was not found in the DOM.`);\r\n      throw new Error(\"KEYBOARD_DOM_ERROR\");\r\n    }\r\n\r\n    /**\r\n     * Modules\r\n     */\r\n    this.modules = {};\r\n    this.loadModules();\r\n  }\r\n\r\n  /**\r\n   * parseParams\r\n   */\r\n  handleParams = (\r\n    selectorOrOptions?: string | HTMLDivElement | KeyboardOptions,\r\n    keyboardOptions?: KeyboardOptions\r\n  ): {\r\n    keyboardDOMClass: string;\r\n    keyboardDOM: KeyboardElement;\r\n    options: Partial<KeyboardOptions | undefined>;\r\n  } => {\r\n    let keyboardDOMClass;\r\n    let keyboardDOM;\r\n    let options;\r\n\r\n    /**\r\n     * If first parameter is a string:\r\n     * Consider it as an element's class\r\n     */\r\n    if (typeof selectorOrOptions === \"string\") {\r\n      keyboardDOMClass = selectorOrOptions.split(\".\").join(\"\");\r\n      keyboardDOM = document.querySelector(\r\n        `.${keyboardDOMClass}`\r\n      ) as KeyboardElement;\r\n      options = keyboardOptions;\r\n\r\n      /**\r\n       * If first parameter is an KeyboardElement\r\n       * Consider it as the keyboard DOM element\r\n       */\r\n    } else if (selectorOrOptions instanceof HTMLDivElement) {\r\n      /**\r\n       * This element must have a class, otherwise throw\r\n       */\r\n      if (!selectorOrOptions.className) {\r\n        console.warn(\"Any DOM element passed as parameter must have a class.\");\r\n        throw new Error(\"KEYBOARD_DOM_CLASS_ERROR\");\r\n      }\r\n\r\n      keyboardDOMClass = selectorOrOptions.className.split(\" \")[0];\r\n      keyboardDOM = selectorOrOptions;\r\n      options = keyboardOptions;\r\n\r\n      /**\r\n       * Otherwise, search for .simple-keyboard DOM element\r\n       */\r\n    } else {\r\n      keyboardDOMClass = \"simple-keyboard\";\r\n      keyboardDOM = document.querySelector(\r\n        `.${keyboardDOMClass}`\r\n      ) as KeyboardElement;\r\n      options = selectorOrOptions;\r\n    }\r\n\r\n    return {\r\n      keyboardDOMClass,\r\n      keyboardDOM,\r\n      options,\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Getters\r\n   */\r\n  getOptions = (): KeyboardOptions => this.options;\r\n  getCaretPosition = (): number | null => this.caretPosition;\r\n  getCaretPositionEnd = (): number | null => this.caretPositionEnd;\r\n\r\n  /**\r\n   * Changes the internal caret position\r\n   * @param {number} position The caret's start position\r\n   * @param {number} positionEnd The caret's end position\r\n   */\r\n  setCaretPosition(position: number | null, endPosition = position): void {\r\n    this.caretPosition = position;\r\n    this.caretPositionEnd = endPosition;\r\n  }\r\n\r\n  /**\r\n   * Retrieve the candidates for a given input\r\n   * @param input The input string to check\r\n   */\r\n  getInputCandidates(\r\n    input: string\r\n  ): { candidateKey: string; candidateValue: string } | Record<string, never> {\r\n    const {\r\n      layoutCandidates: layoutCandidatesObj,\r\n      layoutCandidatesCaseSensitiveMatch,\r\n    } = this.options;\r\n\r\n    if (!layoutCandidatesObj || typeof layoutCandidatesObj !== \"object\") {\r\n      return {};\r\n    }\r\n\r\n    const layoutCandidates = Object.keys(layoutCandidatesObj).filter(\r\n      (layoutCandidate: string) => {\r\n        const inputSubstr =\r\n          input.substring(0, this.getCaretPositionEnd() || 0) || input;\r\n        const regexp = new RegExp(\r\n          `${this.utilities.escapeRegex(layoutCandidate)}$`,\r\n          layoutCandidatesCaseSensitiveMatch ? \"g\" : \"gi\"\r\n        );\r\n        const matches = [...inputSubstr.matchAll(regexp)];\r\n        return !!matches.length;\r\n      }\r\n    );\r\n\r\n    if (layoutCandidates.length > 1) {\r\n      const candidateKey = layoutCandidates.sort(\r\n        (a, b) => b.length - a.length\r\n      )[0];\r\n      return {\r\n        candidateKey,\r\n        candidateValue: layoutCandidatesObj[candidateKey],\r\n      };\r\n    } else if (layoutCandidates.length) {\r\n      const candidateKey = layoutCandidates[0];\r\n      return {\r\n        candidateKey,\r\n        candidateValue: layoutCandidatesObj[candidateKey],\r\n      };\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows a suggestion box with a list of candidate words\r\n   * @param candidates The chosen candidates string as defined in the layoutCandidates option\r\n   * @param targetElement The element next to which the candidates box will be shown\r\n   */\r\n  showCandidatesBox(\r\n    candidateKey: string,\r\n    candidateValue: string,\r\n    targetElement: KeyboardElement\r\n  ): void {\r\n    if (this.candidateBox) {\r\n      this.candidateBox.show({\r\n        candidateValue,\r\n        targetElement,\r\n        onSelect: (selectedCandidate: string, e: MouseEvent) => {\r\n          const { layoutCandidatesCaseSensitiveMatch, disableCandidateNormalization } = this.options;\r\n\r\n          let candidateStr = selectedCandidate;\r\n\r\n          if(!disableCandidateNormalization) {\r\n            /**\r\n             * Making sure that our suggestions are not composed characters\r\n             */\r\n            candidateStr = selectedCandidate.normalize(\"NFD\");\r\n          }\r\n\r\n          const currentInput = this.getInput(this.options.inputName, true);\r\n          const initialCaretPosition = this.getCaretPositionEnd() || 0;\r\n          const inputSubstr =\r\n            currentInput.substring(0, initialCaretPosition || 0) ||\r\n            currentInput;\r\n\r\n          const regexp = new RegExp(\r\n            `${this.utilities.escapeRegex(candidateKey)}$`,\r\n            layoutCandidatesCaseSensitiveMatch ? \"g\" : \"gi\"\r\n          );\r\n          const newInputSubstr = inputSubstr.replace(\r\n            regexp,\r\n            candidateStr\r\n          );\r\n          const newInput = currentInput.replace(inputSubstr, newInputSubstr);\r\n\r\n          const caretPositionDiff = newInputSubstr.length - inputSubstr.length;\r\n          let newCaretPosition =\r\n            (initialCaretPosition || currentInput.length) + caretPositionDiff;\r\n\r\n          if (newCaretPosition < 0) newCaretPosition = 0;\r\n\r\n          this.setInput(newInput, this.options.inputName, true);\r\n          this.setCaretPosition(newCaretPosition);\r\n\r\n          if (typeof this.options.onChange === \"function\")\r\n            this.options.onChange(\r\n              this.getInput(this.options.inputName, true),\r\n              e\r\n            );\r\n\r\n          /**\r\n           * Calling onChangeAll\r\n           */\r\n          if (typeof this.options.onChangeAll === \"function\")\r\n            this.options.onChangeAll(this.getAllInputs(), e);\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles clicks made to keyboard buttons\r\n   * @param  {string} button The button's layout name.\r\n   */\r\n  handleButtonClicked(button: string, e?: KeyboardHandlerEvent): void {\r\n    const { inputName = this.defaultName, debug } = this.options;\r\n    /**\r\n     * Ignoring placeholder buttons\r\n     */\r\n    if (button === \"{//}\") return;\r\n\r\n    /**\r\n     * Creating inputName if it doesn't exist\r\n     */\r\n    if (!this.input[inputName]) this.input[inputName] = \"\";\r\n\r\n    /**\r\n     * Calculating new input\r\n     */\r\n    const updatedInput = this.utilities.getUpdatedInput(\r\n      button,\r\n      this.input[inputName],\r\n      this.caretPosition,\r\n      this.caretPositionEnd\r\n    );\r\n\r\n    /**\r\n     * EDGE CASE: Check for whole input selection changes that will yield same updatedInput\r\n     */\r\n    if (this.utilities.isStandardButton(button) && this.activeInputElement) {\r\n      const isEntireInputSelection =\r\n        this.input[inputName] &&\r\n        this.input[inputName] === updatedInput &&\r\n        this.caretPosition === 0 &&\r\n        this.caretPositionEnd === updatedInput.length;\r\n\r\n      if (isEntireInputSelection) {\r\n        this.setInput(\"\", this.options.inputName, true);\r\n        this.setCaretPosition(0);\r\n        this.activeInputElement.value = \"\";\r\n        this.activeInputElement.setSelectionRange(0, 0);\r\n        this.handleButtonClicked(button, e);\r\n        return;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Calling onKeyPress\r\n     */\r\n    if (typeof this.options.onKeyPress === \"function\")\r\n      this.options.onKeyPress(button, e);\r\n\r\n    if (\r\n      // If input will change as a result of this button press\r\n      this.input[inputName] !== updatedInput &&\r\n      // This pertains to the \"inputPattern\" option:\r\n      // If inputPattern isn't set\r\n      (!this.options.inputPattern ||\r\n        // Or, if it is set and if the pattern is valid - we proceed.\r\n        (this.options.inputPattern && this.inputPatternIsValid(updatedInput)))\r\n    ) {\r\n      /**\r\n       * If maxLength and handleMaxLength yield true, halting\r\n       */\r\n      if (\r\n        this.options.maxLength &&\r\n        this.utilities.handleMaxLength(this.input, updatedInput)\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      /**\r\n       * Updating input\r\n       */\r\n      const newInputValue = this.utilities.getUpdatedInput(\r\n        button,\r\n        this.input[inputName],\r\n        this.caretPosition,\r\n        this.caretPositionEnd,\r\n        true\r\n      );\r\n\r\n      this.setInput(newInputValue, this.options.inputName, true);\r\n\r\n      if (debug) console.log(\"Input changed:\", this.getAllInputs());\r\n\r\n      if (this.options.debug) {\r\n        console.log(\r\n          \"Caret at: \",\r\n          this.getCaretPosition(),\r\n          this.getCaretPositionEnd(),\r\n          `(${this.keyboardDOMClass})`\r\n        );\r\n      }\r\n\r\n      /**\r\n       * Enforce syncInstanceInputs, if set\r\n       */\r\n      if (this.options.syncInstanceInputs) this.syncInstanceInputs();\r\n\r\n      /**\r\n       * Calling onChange\r\n       */\r\n      if (typeof this.options.onChange === \"function\")\r\n        this.options.onChange(this.getInput(this.options.inputName, true), e);\r\n\r\n      /**\r\n       * Calling onChangeAll\r\n       */\r\n      if (typeof this.options.onChangeAll === \"function\")\r\n        this.options.onChangeAll(this.getAllInputs(), e);\r\n\r\n      /**\r\n       * Check if this new input has candidates (suggested words)\r\n       */\r\n      if (e?.target && this.options.enableLayoutCandidates) {\r\n        const { candidateKey, candidateValue } =\r\n          this.getInputCandidates(updatedInput);\r\n\r\n        if (candidateKey && candidateValue) {\r\n          this.showCandidatesBox(\r\n            candidateKey,\r\n            candidateValue,\r\n            this.keyboardDOM\r\n          );\r\n        } else {\r\n          this.candidateBox?.destroy();\r\n        }\r\n      }\r\n    }\r\n\r\n    if (debug) {\r\n      console.log(\"Key pressed:\", button);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get mouse hold state\r\n   */\r\n  getMouseHold() {\r\n    return this.isMouseHold;\r\n  }\r\n\r\n  /**\r\n   * Mark mouse hold state as set\r\n   */\r\n  setMouseHold(value: boolean) {\r\n    if (this.options.syncInstanceInputs) {\r\n      this.dispatch((instance: SimpleKeyboard) => {\r\n        instance.isMouseHold = value;\r\n      });\r\n    } else {\r\n      this.isMouseHold = value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles button mousedown\r\n   */\r\n  /* istanbul ignore next */\r\n  handleButtonMouseDown(button: string, e: KeyboardHandlerEvent): void {\r\n    if (e) {\r\n      /**\r\n       * Handle event options\r\n       */\r\n      if (this.options.preventMouseDownDefault) e.preventDefault();\r\n      if (this.options.stopMouseDownPropagation) e.stopPropagation();\r\n\r\n      /**\r\n       * Add active class\r\n       */\r\n      e.target.classList.add(this.activeButtonClass);\r\n    }\r\n\r\n    if (this.holdInteractionTimeout) clearTimeout(this.holdInteractionTimeout);\r\n    if (this.holdTimeout) clearTimeout(this.holdTimeout);\r\n\r\n    /**\r\n     * @type {boolean} Whether the mouse is being held onKeyPress\r\n     */\r\n    this.setMouseHold(true);\r\n\r\n    /**\r\n     * @type {object} Time to wait until a key hold is detected\r\n     */\r\n    if (!this.options.disableButtonHold) {\r\n      this.holdTimeout = window.setTimeout(() => {\r\n        if (\r\n          (this.getMouseHold() &&\r\n            // TODO: This needs to be configurable through options\r\n            ((!button.includes(\"{\") && !button.includes(\"}\")) ||\r\n              button === \"{delete}\" ||\r\n              button === \"{backspace}\" ||\r\n              button === \"{bksp}\" ||\r\n              button === \"{space}\" ||\r\n              button === \"{tab}\")) ||\r\n          button === \"{arrowright}\" ||\r\n          button === \"{arrowleft}\" ||\r\n          button === \"{arrowup}\" ||\r\n          button === \"{arrowdown}\"\r\n        ) {\r\n          if (this.options.debug) console.log(\"Button held:\", button);\r\n\r\n          this.handleButtonHold(button);\r\n        }\r\n        clearTimeout(this.holdTimeout);\r\n      }, 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles button mouseup\r\n   */\r\n  handleButtonMouseUp(button?: string, e?: KeyboardHandlerEvent): void {\r\n    if (e) {\r\n      /**\r\n       * Handle event options\r\n       */\r\n      if (this.options.preventMouseUpDefault && e.preventDefault)\r\n        e.preventDefault();\r\n      if (this.options.stopMouseUpPropagation && e.stopPropagation)\r\n        e.stopPropagation();\r\n\r\n      /* istanbul ignore next */\r\n      const isKeyboard =\r\n        e.target === this.keyboardDOM ||\r\n        (e.target && this.keyboardDOM.contains(e.target)) ||\r\n        (this.candidateBox &&\r\n          this.candidateBox.candidateBoxElement &&\r\n          (e.target === this.candidateBox.candidateBoxElement ||\r\n            (e.target &&\r\n              this.candidateBox.candidateBoxElement.contains(e.target))));\r\n\r\n      /**\r\n       * On click outside, remove candidateBox\r\n       */\r\n      if (!isKeyboard && this.candidateBox) {\r\n        this.candidateBox.destroy();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Remove active class\r\n     */\r\n    this.recurseButtons((buttonElement: Element) => {\r\n      buttonElement.classList.remove(this.activeButtonClass);\r\n    });\r\n\r\n    this.setMouseHold(false);\r\n    if (this.holdInteractionTimeout) clearTimeout(this.holdInteractionTimeout);\r\n\r\n    /**\r\n     * Calling onKeyReleased\r\n     */\r\n    if (button && typeof this.options.onKeyReleased === \"function\")\r\n      this.options.onKeyReleased(button);\r\n  }\r\n\r\n  /**\r\n   * Handles container mousedown\r\n   */\r\n  handleKeyboardContainerMouseDown(e: KeyboardHandlerEvent): void {\r\n    /**\r\n     * Handle event options\r\n     */\r\n    if (this.options.preventMouseDownDefault) e.preventDefault();\r\n  }\r\n\r\n  /**\r\n   * Handles button hold\r\n   */\r\n  /* istanbul ignore next */\r\n  handleButtonHold(button: string): void {\r\n    if (this.holdInteractionTimeout) clearTimeout(this.holdInteractionTimeout);\r\n\r\n    /**\r\n     * @type {object} Timeout dictating the speed of key hold iterations\r\n     */\r\n    this.holdInteractionTimeout = window.setTimeout(() => {\r\n      if (this.getMouseHold()) {\r\n        this.handleButtonClicked(button);\r\n        this.handleButtonHold(button);\r\n      } else {\r\n        clearTimeout(this.holdInteractionTimeout);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Send a command to all simple-keyboard instances (if you have several instances).\r\n   */\r\n  syncInstanceInputs(): void {\r\n    this.dispatch((instance: SimpleKeyboard) => {\r\n      instance.replaceInput(this.input);\r\n      instance.setCaretPosition(this.caretPosition, this.caretPositionEnd);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the keyboard’s input.\r\n   * @param {string} [inputName] optional - the internal input to select\r\n   */\r\n  clearInput(\r\n    inputName: string = this.options.inputName || this.defaultName\r\n  ): void {\r\n    this.input[inputName] = \"\";\r\n\r\n    /**\r\n     * Reset caretPosition\r\n     */\r\n    this.setCaretPosition(0);\r\n\r\n    /**\r\n     * Enforce syncInstanceInputs, if set\r\n     */\r\n    if (this.options.syncInstanceInputs) this.syncInstanceInputs();\r\n  }\r\n\r\n  /**\r\n   * Get the keyboard’s input (You can also get it from the onChange prop).\r\n   * @param  {string} [inputName] optional - the internal input to select\r\n   */\r\n  getInput(\r\n    inputName: string = this.options.inputName || this.defaultName,\r\n    skipSync = false\r\n  ): string {\r\n    /**\r\n     * Enforce syncInstanceInputs, if set\r\n     */\r\n    if (this.options.syncInstanceInputs && !skipSync) this.syncInstanceInputs();\r\n\r\n    if (this.options.rtl) {\r\n      // Remove existing control chars\r\n      const inputWithoutRTLControl = this.input[inputName]\r\n        .replace(\"\\u202B\", \"\")\r\n        .replace(\"\\u202C\", \"\");\r\n\r\n      return \"\\u202B\" + inputWithoutRTLControl + \"\\u202C\";\r\n    } else {\r\n      return this.input[inputName];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all simple-keyboard inputs\r\n   */\r\n  getAllInputs(): KeyboardInput {\r\n    const output = {};\r\n    const inputNames = Object.keys(this.input);\r\n\r\n    inputNames.forEach((inputName) => {\r\n      output[inputName] = this.getInput(inputName, true);\r\n    });\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Set the keyboard’s input.\r\n   * @param  {string} input the input value\r\n   * @param  {string} inputName optional - the internal input to select\r\n   */\r\n  setInput(\r\n    input: string,\r\n    inputName: string = this.options.inputName || this.defaultName,\r\n    skipSync?: boolean\r\n  ): void {\r\n    this.input[inputName] = input;\r\n\r\n    /**\r\n     * Enforce syncInstanceInputs, if set\r\n     */\r\n    if (!skipSync && this.options.syncInstanceInputs) this.syncInstanceInputs();\r\n  }\r\n\r\n  /**\r\n   * Replace the input object (`keyboard.input`)\r\n   * @param  {object} inputObj The input object\r\n   */\r\n  replaceInput(inputObj: KeyboardInput): void {\r\n    this.input = inputObj;\r\n  }\r\n\r\n  /**\r\n   * Set new option or modify existing ones after initialization.\r\n   * @param  {object} options The options to set\r\n   */\r\n  setOptions(options = {}): void {\r\n    const changedOptions = this.changedOptions(options);\r\n    this.options = Object.assign(this.options, options);\r\n\r\n    if (changedOptions.length) {\r\n      if (this.options.debug) {\r\n        console.log(\"changedOptions\", changedOptions);\r\n      }\r\n\r\n      /**\r\n       * Some option changes require adjustments before re-render\r\n       */\r\n      this.onSetOptions(changedOptions);\r\n\r\n      /**\r\n       * Rendering\r\n       */\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detecting changes to non-function options\r\n   * This allows us to ascertain whether a button re-render is needed\r\n   */\r\n  changedOptions(newOptions: Partial<KeyboardOptions>): string[] {\r\n    return Object.keys(newOptions).filter(\r\n      (optionName) =>\r\n        JSON.stringify(newOptions[optionName]) !==\r\n        JSON.stringify(this.options[optionName])\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Executing actions depending on changed options\r\n   * @param  {object} options The options to set\r\n   */\r\n  onSetOptions(changedOptions: string[] = []): void {\r\n    /**\r\n     * Changed: layoutName\r\n     */\r\n    if (changedOptions.includes(\"layoutName\")) {\r\n      /**\r\n       * Reset candidateBox\r\n       */\r\n      if (this.candidateBox) {\r\n        this.candidateBox.destroy();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Changed: layoutCandidatesPageSize, layoutCandidates\r\n     */\r\n    if (\r\n      changedOptions.includes(\"layoutCandidatesPageSize\") ||\r\n      changedOptions.includes(\"layoutCandidates\")\r\n    ) {\r\n      /**\r\n       * Reset and recreate candidateBox\r\n       */\r\n      if (this.candidateBox) {\r\n        this.candidateBox.destroy();\r\n        this.candidateBox = new CandidateBox({\r\n          utilities: this.utilities,\r\n          options: this.options,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all keyboard rows and reset keyboard values.\r\n   * Used internally between re-renders.\r\n   */\r\n  resetRows(): void {\r\n    if (this.keyboardRowsDOM) {\r\n      this.keyboardRowsDOM.remove();\r\n    }\r\n\r\n    this.keyboardDOM.className = this.keyboardDOMClass;\r\n    this.keyboardDOM.setAttribute(\"data-skInstance\", this.currentInstanceName);\r\n    this.buttonElements = {};\r\n  }\r\n\r\n  /**\r\n   * Send a command to all simple-keyboard instances at once (if you have multiple instances).\r\n   * @param  {function(instance: object, key: string)} callback Function to run on every instance\r\n   */\r\n  // eslint-disable-next-line no-unused-vars\r\n  dispatch(callback: (instance: SimpleKeyboard, key?: string) => void): void {\r\n    if (!window[\"SimpleKeyboardInstances\"]) {\r\n      console.warn(\r\n        `SimpleKeyboardInstances is not defined. Dispatch cannot be called.`\r\n      );\r\n      throw new Error(\"INSTANCES_VAR_ERROR\");\r\n    }\r\n\r\n    return Object.keys(window[\"SimpleKeyboardInstances\"]).forEach((key) => {\r\n      callback(window[\"SimpleKeyboardInstances\"][key], key);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds/Modifies an entry to the `buttonTheme`. Basically a way to add a class to a button.\r\n   * @param  {string} buttons List of buttons to select (separated by a space).\r\n   * @param  {string} className Classes to give to the selected buttons (separated by space).\r\n   */\r\n  addButtonTheme(buttons: string, className: string): void {\r\n    if (!className || !buttons) return;\r\n\r\n    buttons.split(\" \").forEach((button) => {\r\n      className.split(\" \").forEach((classNameItem) => {\r\n        if (!this.options.buttonTheme) this.options.buttonTheme = [];\r\n\r\n        let classNameFound = false;\r\n\r\n        /**\r\n         * If class is already defined, we add button to class definition\r\n         */\r\n        this.options.buttonTheme.map((buttonTheme) => {\r\n          if (buttonTheme?.class.split(\" \").includes(classNameItem)) {\r\n            classNameFound = true;\r\n\r\n            const buttonThemeArray = buttonTheme.buttons.split(\" \");\r\n            if (!buttonThemeArray.includes(button)) {\r\n              classNameFound = true;\r\n              buttonThemeArray.push(button);\r\n              buttonTheme.buttons = buttonThemeArray.join(\" \");\r\n            }\r\n          }\r\n          return buttonTheme;\r\n        });\r\n\r\n        /**\r\n         * If class is not defined, we create a new entry\r\n         */\r\n        if (!classNameFound) {\r\n          this.options.buttonTheme.push({\r\n            class: classNameItem,\r\n            buttons: buttons,\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Removes/Amends an entry to the `buttonTheme`. Basically a way to remove a class previously added to a button through buttonTheme or addButtonTheme.\r\n   * @param  {string} buttons List of buttons to select (separated by a space).\r\n   * @param  {string} className Classes to give to the selected buttons (separated by space).\r\n   */\r\n  removeButtonTheme(buttons: string, className: string): void {\r\n    /**\r\n     * When called with empty parameters, remove all button themes\r\n     */\r\n    if (!buttons && !className) {\r\n      this.options.buttonTheme = [];\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    /**\r\n     * If buttons are passed and buttonTheme has items\r\n     */\r\n    if (\r\n      buttons &&\r\n      Array.isArray(this.options.buttonTheme) &&\r\n      this.options.buttonTheme.length\r\n    ) {\r\n      const buttonArray = buttons.split(\" \");\r\n      buttonArray.forEach((button) => {\r\n        this.options?.buttonTheme?.map((buttonTheme, index) => {\r\n          /**\r\n           * If className is set, we affect the buttons only for that class\r\n           * Otherwise, we afect all classes\r\n           */\r\n          if (\r\n            (buttonTheme &&\r\n              className &&\r\n              className.includes(buttonTheme.class)) ||\r\n            !className\r\n          ) {\r\n            const filteredButtonArray = buttonTheme?.buttons\r\n              .split(\" \")\r\n              .filter((item) => item !== button);\r\n\r\n            /**\r\n             * If buttons left, return them, otherwise, remove button Theme\r\n             */\r\n            if (buttonTheme && filteredButtonArray?.length) {\r\n              buttonTheme.buttons = filteredButtonArray.join(\" \");\r\n            } else {\r\n              this.options.buttonTheme?.splice(index, 1);\r\n              buttonTheme = null;\r\n            }\r\n          }\r\n\r\n          return buttonTheme;\r\n        });\r\n      });\r\n\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the DOM Element of a button. If there are several buttons with the same name, an array of the DOM Elements is returned.\r\n   * @param  {string} button The button layout name to select\r\n   */\r\n  getButtonElement(\r\n    button: string\r\n  ): KeyboardElement | KeyboardElement[] | undefined {\r\n    let output;\r\n\r\n    const buttonArr = this.buttonElements[button];\r\n    if (buttonArr) {\r\n      if (buttonArr.length > 1) {\r\n        output = buttonArr;\r\n      } else {\r\n        output = buttonArr[0];\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * This handles the \"inputPattern\" option\r\n   * by checking if the provided inputPattern passes\r\n   */\r\n  inputPatternIsValid(inputVal: string): boolean {\r\n    const inputPatternRaw = this.options.inputPattern;\r\n    let inputPattern;\r\n\r\n    /**\r\n     * Check if input pattern is global or targeted to individual inputs\r\n     */\r\n    if (inputPatternRaw instanceof RegExp) {\r\n      inputPattern = inputPatternRaw;\r\n    } else {\r\n      inputPattern =\r\n        inputPatternRaw[this.options.inputName || this.defaultName];\r\n    }\r\n\r\n    if (inputPattern && inputVal) {\r\n      const didInputMatch = inputPattern.test(inputVal);\r\n\r\n      if (this.options.debug) {\r\n        console.log(\r\n          `inputPattern (\"${inputPattern}\"): ${\r\n            didInputMatch ? \"passed\" : \"did not pass!\"\r\n          }`\r\n        );\r\n      }\r\n\r\n      return didInputMatch;\r\n    } else {\r\n      /**\r\n       * inputPattern doesn't seem to be set for the current input, or input is empty. Pass.\r\n       */\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles simple-keyboard event listeners\r\n   */\r\n  setEventListeners(): void {\r\n    /**\r\n     * Only first instance should set the event listeners\r\n     */\r\n    if (this.isFirstKeyboardInstance || !this.allKeyboardInstances) {\r\n      if (this.options.debug) {\r\n        console.log(`Caret handling started (${this.keyboardDOMClass})`);\r\n      }\r\n\r\n      /**\r\n       * Event Listeners\r\n       */\r\n      document.addEventListener(\"keyup\", this.handleKeyUp);\r\n      document.addEventListener(\"keydown\", this.handleKeyDown);\r\n      document.addEventListener(\"mouseup\", this.handleMouseUp);\r\n      document.addEventListener(\"touchend\", this.handleTouchEnd);\r\n      document.addEventListener(\"select\", this.handleSelect);\r\n      document.addEventListener(\"selectionchange\", this.handleSelectionChange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event Handler: KeyUp\r\n   */\r\n  handleKeyUp(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n\r\n    if (this.options.physicalKeyboardHighlight) {\r\n      this.physicalKeyboard.handleHighlightKeyUp(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event Handler: KeyDown\r\n   */\r\n  handleKeyDown(event: KeyboardHandlerEvent): void {\r\n    if (this.options.physicalKeyboardHighlight) {\r\n      this.physicalKeyboard.handleHighlightKeyDown(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event Handler: MouseUp\r\n   */\r\n  handleMouseUp(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: TouchEnd\r\n   */\r\n  /* istanbul ignore next */\r\n  handleTouchEnd(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: Select\r\n   */\r\n  /* istanbul ignore next */\r\n  handleSelect(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: SelectionChange\r\n   */\r\n  /* istanbul ignore next */\r\n  handleSelectionChange(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n  }\r\n\r\n  /**\r\n   * Called by {@link setEventListeners} when an event that warrants a cursor position update is triggered\r\n   */\r\n  caretEventHandler(event: KeyboardHandlerEvent): void {\r\n    let targetTagName: string;\r\n    if (event.target.tagName) {\r\n      targetTagName = event.target.tagName.toLowerCase();\r\n    }\r\n\r\n    this.dispatch((instance) => {\r\n      let isKeyboard =\r\n        event.target === instance.keyboardDOM ||\r\n        (event.target && instance.keyboardDOM.contains(event.target));\r\n\r\n      /**\r\n       * If syncInstanceInputs option is enabled, make isKeyboard match any instance\r\n       * not just the current one\r\n       */\r\n      if (this.options.syncInstanceInputs && Array.isArray(event.path)) {\r\n        isKeyboard = event.path.some((item: HTMLElement) =>\r\n          item?.hasAttribute?.(\"data-skInstance\")\r\n        );\r\n      }\r\n\r\n      if (\r\n        (targetTagName === \"textarea\" ||\r\n          (targetTagName === \"input\" &&\r\n            [\"text\", \"search\", \"url\", \"tel\", \"password\"].includes(\r\n              event.target.type\r\n            ))) &&\r\n        !instance.options.disableCaretPositioning\r\n      ) {\r\n        /**\r\n         * Tracks current cursor position\r\n         * As keys are pressed, text will be added/removed at that position within the input.\r\n         */\r\n        let selectionStart = event.target.selectionStart;\r\n        let selectionEnd = event.target.selectionEnd;\r\n\r\n        if(instance.options.rtl){\r\n          selectionStart = instance.utilities.getRtlOffset(selectionStart, instance.getInput());\r\n          selectionEnd = instance.utilities.getRtlOffset(selectionEnd, instance.getInput());\r\n        }\r\n\r\n        instance.setCaretPosition(selectionStart, selectionEnd);\r\n\r\n        /**\r\n         * Tracking current input in order to handle caret positioning edge cases\r\n         */\r\n        this.activeInputElement = event.target;\r\n\r\n        if (instance.options.debug) {\r\n          console.log(\r\n            \"Caret at: \",\r\n            instance.getCaretPosition(),\r\n            instance.getCaretPositionEnd(),\r\n            event && event.target.tagName.toLowerCase(),\r\n            `(${instance.keyboardDOMClass})`\r\n          );\r\n        }\r\n      } else if (\r\n        (instance.options.disableCaretPositioning || !isKeyboard) &&\r\n        event?.type !== \"selectionchange\"\r\n      ) {\r\n        /**\r\n         * If we toggled off disableCaretPositioning, we must ensure caretPosition doesn't persist once reactivated.\r\n         */\r\n        instance.setCaretPosition(null);\r\n\r\n        /**\r\n         * Resetting activeInputElement\r\n         */\r\n        this.activeInputElement = null;\r\n\r\n        if (instance.options.debug) {\r\n          console.log(\r\n            `Caret position reset due to \"${event?.type}\" event`,\r\n            event\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Execute an operation on each button\r\n   */\r\n  recurseButtons(fn: any): void {\r\n    if (!fn) return;\r\n\r\n    Object.keys(this.buttonElements).forEach((buttonName) =>\r\n      this.buttonElements[buttonName].forEach(fn)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Destroy keyboard listeners and DOM elements\r\n   */\r\n  destroy(): void {\r\n    if (this.options.debug)\r\n      console.log(\r\n        `Destroying simple-keyboard instance: ${this.currentInstanceName}`\r\n      );\r\n\r\n    /**\r\n     * Remove document listeners\r\n     */\r\n    document.removeEventListener(\"keyup\", this.handleKeyUp);\r\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\r\n    document.removeEventListener(\"mouseup\", this.handleMouseUp);\r\n    document.removeEventListener(\"touchend\", this.handleTouchEnd);\r\n    document.removeEventListener(\"select\", this.handleSelect);\r\n    document.removeEventListener(\"selectionchange\", this.handleSelectionChange);\r\n    document.onpointerup = null;\r\n    document.ontouchend = null;\r\n    document.ontouchcancel = null;\r\n    document.onmouseup = null;\r\n\r\n    /**\r\n     * Remove buttons\r\n     */\r\n    const deleteButton = (buttonElement: KeyboardElement | null) => {\r\n      if (buttonElement) {\r\n        buttonElement.onpointerdown = null;\r\n        buttonElement.onpointerup = null;\r\n        buttonElement.onpointercancel = null;\r\n        buttonElement.ontouchstart = null;\r\n        buttonElement.ontouchend = null;\r\n        buttonElement.ontouchcancel = null;\r\n        buttonElement.onclick = null;\r\n        buttonElement.onmousedown = null;\r\n        buttonElement.onmouseup = null;\r\n\r\n        buttonElement.remove();\r\n        buttonElement = null;\r\n      }\r\n    };\r\n\r\n    this.recurseButtons(deleteButton);\r\n\r\n    /**\r\n     * Remove wrapper events\r\n     */\r\n    this.keyboardDOM.onpointerdown = null;\r\n    this.keyboardDOM.ontouchstart = null;\r\n    this.keyboardDOM.onmousedown = null;\r\n\r\n    /**\r\n     * Clearing keyboard rows\r\n     */\r\n    this.resetRows();\r\n\r\n    /**\r\n     * Candidate box\r\n     */\r\n    if (this.candidateBox) {\r\n      this.candidateBox.destroy();\r\n      this.candidateBox = null;\r\n    }\r\n\r\n    /**\r\n     * Clearing activeInputElement\r\n     */\r\n    this.activeInputElement = null;\r\n\r\n    /**\r\n     * Removing instance attribute\r\n     */\r\n    this.keyboardDOM.removeAttribute(\"data-skInstance\");\r\n\r\n    /**\r\n     * Clearing keyboardDOM\r\n     */\r\n    this.keyboardDOM.innerHTML = \"\";\r\n\r\n    /**\r\n     * Remove instance\r\n     */\r\n    window[\"SimpleKeyboardInstances\"][this.currentInstanceName] = null;\r\n    delete window[\"SimpleKeyboardInstances\"][this.currentInstanceName];\r\n\r\n    /**\r\n     * Reset initialized flag\r\n     */\r\n    this.initialized = false;\r\n  }\r\n\r\n  /**\r\n   * Process buttonTheme option\r\n   */\r\n  getButtonThemeClasses(button: string): string[] {\r\n    const buttonTheme = this.options.buttonTheme;\r\n    let buttonClasses: string[] = [];\r\n\r\n    if (Array.isArray(buttonTheme)) {\r\n      buttonTheme.forEach((themeObj) => {\r\n        if (\r\n          themeObj &&\r\n          themeObj.class &&\r\n          typeof themeObj.class === \"string\" &&\r\n          themeObj.buttons &&\r\n          typeof themeObj.buttons === \"string\"\r\n        ) {\r\n          const themeObjClasses = themeObj.class.split(\" \");\r\n          const themeObjButtons = themeObj.buttons.split(\" \");\r\n\r\n          if (themeObjButtons.includes(button)) {\r\n            buttonClasses = [...buttonClasses, ...themeObjClasses];\r\n          }\r\n        } else {\r\n          console.warn(\r\n            `Incorrect \"buttonTheme\". Please check the documentation.`,\r\n            themeObj\r\n          );\r\n        }\r\n      });\r\n    }\r\n\r\n    return buttonClasses;\r\n  }\r\n\r\n  /**\r\n   * Process buttonAttributes option\r\n   */\r\n  setDOMButtonAttributes(button: string, callback: any): void {\r\n    const buttonAttributes = this.options.buttonAttributes;\r\n\r\n    if (Array.isArray(buttonAttributes)) {\r\n      buttonAttributes.forEach((attrObj) => {\r\n        if (\r\n          attrObj.attribute &&\r\n          typeof attrObj.attribute === \"string\" &&\r\n          attrObj.value &&\r\n          typeof attrObj.value === \"string\" &&\r\n          attrObj.buttons &&\r\n          typeof attrObj.buttons === \"string\"\r\n        ) {\r\n          const attrObjButtons = attrObj.buttons.split(\" \");\r\n\r\n          if (attrObjButtons.includes(button)) {\r\n            callback(attrObj.attribute, attrObj.value);\r\n          }\r\n        } else {\r\n          console.warn(\r\n            `Incorrect \"buttonAttributes\". Please check the documentation.`,\r\n            attrObj\r\n          );\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  onTouchDeviceDetected() {\r\n    /**\r\n     * Processing autoTouchEvents\r\n     */\r\n    this.processAutoTouchEvents();\r\n\r\n    /**\r\n     * Disabling contextual window on touch devices\r\n     */\r\n    this.disableContextualWindow();\r\n  }\r\n\r\n  /**\r\n   * Disabling contextual window for hg-button\r\n   */\r\n  /* istanbul ignore next */\r\n  disableContextualWindow() {\r\n    window.oncontextmenu = (event: KeyboardHandlerEvent) => {\r\n      if (event.target.classList.contains(\"hg-button\")) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return false;\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Process autoTouchEvents option\r\n   */\r\n  processAutoTouchEvents() {\r\n    if (this.options.autoUseTouchEvents) {\r\n      this.options.useTouchEvents = true;\r\n\r\n      if (this.options.debug) {\r\n        console.log(\r\n          `autoUseTouchEvents: Touch device detected, useTouchEvents enabled.`\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function once simple-keyboard is rendered for the first time (on initialization).\r\n   */\r\n  onInit() {\r\n    if (this.options.debug) {\r\n      console.log(`${this.keyboardDOMClass} Initialized`);\r\n    }\r\n\r\n    /**\r\n     * setEventListeners\r\n     */\r\n    this.setEventListeners();\r\n\r\n    if (typeof this.options.onInit === \"function\") this.options.onInit(this);\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function before a simple-keyboard render.\r\n   */\r\n  beforeFirstRender() {\r\n    /**\r\n     * Performing actions when touch device detected\r\n     */\r\n    if (this.utilities.isTouchDevice()) {\r\n      this.onTouchDeviceDetected();\r\n    }\r\n\r\n    if (typeof this.options.beforeFirstRender === \"function\")\r\n      this.options.beforeFirstRender(this);\r\n\r\n    /**\r\n     * Notify about PointerEvents usage\r\n     */\r\n    if (\r\n      this.isFirstKeyboardInstance &&\r\n      this.utilities.pointerEventsSupported() &&\r\n      !this.options.useTouchEvents &&\r\n      !this.options.useMouseEvents\r\n    ) {\r\n      if (this.options.debug) {\r\n        console.log(\"Using PointerEvents as it is supported by this browser\");\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Notify about touch events usage\r\n     */\r\n    if (this.options.useTouchEvents) {\r\n      if (this.options.debug) {\r\n        console.log(\r\n          \"useTouchEvents has been enabled. Only touch events will be used.\"\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function before a simple-keyboard render.\r\n   */\r\n  beforeRender() {\r\n    if (typeof this.options.beforeRender === \"function\")\r\n      this.options.beforeRender(this);\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function every time simple-keyboard is rendered (e.g: when you change layouts).\r\n   */\r\n  onRender() {\r\n    if (typeof this.options.onRender === \"function\")\r\n      this.options.onRender(this);\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function once all modules have been loaded\r\n   */\r\n  onModulesLoaded() {\r\n    if (typeof this.options.onModulesLoaded === \"function\")\r\n      this.options.onModulesLoaded(this);\r\n  }\r\n\r\n  /**\r\n   * Register module\r\n   */\r\n  registerModule = (name: string, initCallback: any) => {\r\n    if (!this.modules[name]) this.modules[name] = {};\r\n\r\n    initCallback(this.modules[name]);\r\n  };\r\n\r\n  /**\r\n   * Load modules\r\n   */\r\n  loadModules() {\r\n    if (Array.isArray(this.options.modules)) {\r\n      this.options.modules.forEach((KeyboardModule) => {\r\n        const keyboardModule = new KeyboardModule(this);\r\n        keyboardModule.init && keyboardModule.init(this);\r\n      });\r\n\r\n      this.keyboardPluginClasses = \"modules-loaded\";\r\n\r\n      this.render();\r\n      this.onModulesLoaded();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get module prop\r\n   */\r\n  getModuleProp(name: string, prop: string) {\r\n    if (!this.modules[name]) return false;\r\n\r\n    return this.modules[name][prop];\r\n  }\r\n\r\n  /**\r\n   * getModulesList\r\n   */\r\n  getModulesList() {\r\n    return Object.keys(this.modules);\r\n  }\r\n\r\n  /**\r\n   * Parse Row DOM containers\r\n   */\r\n  parseRowDOMContainers(\r\n    rowDOM: HTMLDivElement,\r\n    rowIndex: number,\r\n    containerStartIndexes: number[],\r\n    containerEndIndexes: number[]\r\n  ) {\r\n    const rowDOMArray = Array.from(rowDOM.children);\r\n    let removedElements = 0;\r\n\r\n    if (rowDOMArray.length) {\r\n      containerStartIndexes.forEach((startIndex, arrIndex) => {\r\n        const endIndex = containerEndIndexes[arrIndex];\r\n\r\n        /**\r\n         * If there exists a respective end index\r\n         * if end index comes after start index\r\n         */\r\n        if (!endIndex || !(endIndex > startIndex)) {\r\n          return false;\r\n        }\r\n\r\n        /**\r\n         * Updated startIndex, endIndex\r\n         * This is since the removal of buttons to place a single button container\r\n         * results in a modified array size\r\n         */\r\n        const updated_startIndex = startIndex - removedElements;\r\n        const updated_endIndex = endIndex - removedElements;\r\n\r\n        /**\r\n         * Create button container\r\n         */\r\n        const containerDOM = document.createElement(\"div\");\r\n        containerDOM.className += \"hg-button-container\";\r\n        const containerUID = `${this.options.layoutName}-r${rowIndex}c${arrIndex}`;\r\n        containerDOM.setAttribute(\"data-skUID\", containerUID);\r\n\r\n        /**\r\n         * Taking elements due to be inserted into container\r\n         */\r\n        const containedElements = rowDOMArray.splice(\r\n          updated_startIndex,\r\n          updated_endIndex - updated_startIndex + 1\r\n        );\r\n        removedElements = updated_endIndex - updated_startIndex;\r\n\r\n        /**\r\n         * Inserting elements to container\r\n         */\r\n        containedElements.forEach((element) =>\r\n          containerDOM.appendChild(element)\r\n        );\r\n\r\n        /**\r\n         * Adding container at correct position within rowDOMArray\r\n         */\r\n        rowDOMArray.splice(updated_startIndex, 0, containerDOM);\r\n\r\n        /**\r\n         * Clearing old rowDOM children structure\r\n         */\r\n        rowDOM.innerHTML = \"\";\r\n\r\n        /**\r\n         * Appending rowDOM new children list\r\n         */\r\n        rowDOMArray.forEach((element) => rowDOM.appendChild(element));\r\n\r\n        if (this.options.debug) {\r\n          console.log(\r\n            \"rowDOMContainer\",\r\n            containedElements,\r\n            updated_startIndex,\r\n            updated_endIndex,\r\n            removedElements + 1\r\n          );\r\n        }\r\n      });\r\n    }\r\n\r\n    return rowDOM;\r\n  }\r\n\r\n  /**\r\n   * getKeyboardClassString\r\n   */\r\n  getKeyboardClassString = (...baseDOMClasses: any[]) => {\r\n    const keyboardClasses = [this.keyboardDOMClass, ...baseDOMClasses].filter(\r\n      (DOMClass) => !!DOMClass\r\n    );\r\n\r\n    return keyboardClasses.join(\" \");\r\n  };\r\n\r\n  /**\r\n   * Renders rows and buttons as per options\r\n   */\r\n  render() {\r\n    /**\r\n     * Clear keyboard\r\n     */\r\n    this.resetRows();\r\n\r\n    /**\r\n     * Calling beforeFirstRender\r\n     */\r\n    if (!this.initialized) {\r\n      this.beforeFirstRender();\r\n    }\r\n\r\n    /**\r\n     * Calling beforeRender\r\n     */\r\n    this.beforeRender();\r\n\r\n    const layoutClass = `hg-layout-${this.options.layoutName}`;\r\n    const layout = this.options.layout || getDefaultLayout();\r\n    const useTouchEvents = this.options.useTouchEvents || false;\r\n    const useTouchEventsClass = useTouchEvents ? \"hg-touch-events\" : \"\";\r\n    const useMouseEvents = this.options.useMouseEvents || false;\r\n    const disableRowButtonContainers = this.options.disableRowButtonContainers;\r\n\r\n    /**\r\n     * Adding themeClass, layoutClass to keyboardDOM\r\n     */\r\n    this.keyboardDOM.className = this.getKeyboardClassString(\r\n      this.options.theme,\r\n      layoutClass,\r\n      this.keyboardPluginClasses,\r\n      useTouchEventsClass\r\n    );\r\n\r\n    /**\r\n     * Adding keyboard identifier\r\n     */\r\n    this.keyboardDOM.setAttribute(\"data-skInstance\", this.currentInstanceName);\r\n\r\n    /**\r\n     * Create row wrapper\r\n     */\r\n    this.keyboardRowsDOM = document.createElement(\"div\");\r\n    this.keyboardRowsDOM.className = \"hg-rows\";\r\n\r\n    /**\r\n     * Iterating through each row\r\n     */\r\n    layout[this.options.layoutName || this.defaultName].forEach(\r\n      (row, rIndex) => {\r\n        let rowArray = row.split(\" \");\r\n\r\n        /**\r\n         * Enforce excludeFromLayout\r\n         */\r\n        if (\r\n          this.options.excludeFromLayout &&\r\n          this.options.excludeFromLayout[\r\n            this.options.layoutName || this.defaultName\r\n          ]\r\n        ) {\r\n          rowArray = rowArray.filter(\r\n            (buttonName) =>\r\n              this.options.excludeFromLayout &&\r\n              !this.options.excludeFromLayout[\r\n                this.options.layoutName || this.defaultName\r\n              ].includes(buttonName)\r\n          );\r\n        }\r\n\r\n        /**\r\n         * Creating empty row\r\n         */\r\n        let rowDOM = document.createElement(\"div\");\r\n        rowDOM.className += \"hg-row\";\r\n\r\n        /**\r\n         * Tracking container indicators in rows\r\n         */\r\n        const containerStartIndexes: number[] = [];\r\n        const containerEndIndexes: number[] = [];\r\n\r\n        /**\r\n         * Iterating through each button in row\r\n         */\r\n        rowArray.forEach((button, bIndex) => {\r\n          /**\r\n           * Check if button has a container indicator\r\n           */\r\n          const buttonHasContainerStart =\r\n            !disableRowButtonContainers &&\r\n            typeof button === \"string\" &&\r\n            button.length > 1 &&\r\n            button.indexOf(\"[\") === 0;\r\n\r\n          const buttonHasContainerEnd =\r\n            !disableRowButtonContainers &&\r\n            typeof button === \"string\" &&\r\n            button.length > 1 &&\r\n            button.indexOf(\"]\") === button.length - 1;\r\n\r\n          /**\r\n           * Save container start index, if applicable\r\n           */\r\n          if (buttonHasContainerStart) {\r\n            containerStartIndexes.push(bIndex);\r\n\r\n            /**\r\n             * Removing indicator\r\n             */\r\n            button = button.replace(/\\[/g, \"\");\r\n          }\r\n\r\n          if (buttonHasContainerEnd) {\r\n            containerEndIndexes.push(bIndex);\r\n\r\n            /**\r\n             * Removing indicator\r\n             */\r\n            button = button.replace(/\\]/g, \"\");\r\n          }\r\n\r\n          /**\r\n           * Processing button options\r\n           */\r\n          const fctBtnClass = this.utilities.getButtonClass(button);\r\n          const buttonDisplayName = this.utilities.getButtonDisplayName(\r\n            button,\r\n            this.options.display,\r\n            this.options.mergeDisplay\r\n          );\r\n\r\n          /**\r\n           * Creating button\r\n           */\r\n          const buttonType = this.options.useButtonTag ? \"button\" : \"div\";\r\n          const buttonDOM = document.createElement(buttonType);\r\n          buttonDOM.className += `hg-button ${fctBtnClass}`;\r\n\r\n          /**\r\n           * Adding buttonTheme\r\n           */\r\n          buttonDOM.classList.add(...this.getButtonThemeClasses(button));\r\n\r\n          /**\r\n           * Adding buttonAttributes\r\n           */\r\n          this.setDOMButtonAttributes(\r\n            button,\r\n            (attribute: string, value: string) => {\r\n              buttonDOM.setAttribute(attribute, value);\r\n            }\r\n          );\r\n\r\n          this.activeButtonClass = \"hg-activeButton\";\r\n\r\n          /**\r\n           * Handle button click event\r\n           */\r\n          /* istanbul ignore next */\r\n          if (\r\n            this.utilities.pointerEventsSupported() &&\r\n            !useTouchEvents &&\r\n            !useMouseEvents\r\n          ) {\r\n            /**\r\n             * Handle PointerEvents\r\n             */\r\n            buttonDOM.onpointerdown = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonClicked(button, e);\r\n              this.handleButtonMouseDown(button, e);\r\n            };\r\n            buttonDOM.onpointerup = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonMouseUp(button, e);\r\n            };\r\n            buttonDOM.onpointercancel = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonMouseUp(button, e);\r\n            };\r\n          } else {\r\n            /**\r\n             * Fallback for browsers not supporting PointerEvents\r\n             */\r\n            if (useTouchEvents) {\r\n              /**\r\n               * Handle touch events\r\n               */\r\n              buttonDOM.ontouchstart = (e: KeyboardHandlerEvent) => {\r\n                this.handleButtonClicked(button, e);\r\n                this.handleButtonMouseDown(button, e);\r\n              };\r\n              buttonDOM.ontouchend = (e: KeyboardHandlerEvent) => {\r\n                this.handleButtonMouseUp(button, e);\r\n              };\r\n              buttonDOM.ontouchcancel = (e: KeyboardHandlerEvent) => {\r\n                this.handleButtonMouseUp(button, e);\r\n              };\r\n            } else {\r\n              /**\r\n               * Handle mouse events\r\n               */\r\n              buttonDOM.onclick = (e: KeyboardHandlerEvent) => {\r\n                this.setMouseHold(false);\r\n                /**\r\n                 * Fire button handler in onclick for compatibility reasons\r\n                 * This fires handler before onKeyReleased, therefore when that option is set we will fire the handler\r\n                 * in onmousedown instead\r\n                 */\r\n                if (typeof this.options.onKeyReleased !== \"function\") {\r\n                  this.handleButtonClicked(button, e);\r\n                }\r\n              };\r\n              buttonDOM.onmousedown = (e: KeyboardHandlerEvent) => {\r\n                /**\r\n                 * Fire button handler for onKeyReleased use-case\r\n                 */\r\n                if (\r\n                  typeof this.options.onKeyReleased === \"function\" &&\r\n                  !this.isMouseHold\r\n                ) {\r\n                  this.handleButtonClicked(button, e);\r\n                }\r\n                this.handleButtonMouseDown(button, e);\r\n              };\r\n              buttonDOM.onmouseup = (e: KeyboardHandlerEvent) => {\r\n                this.handleButtonMouseUp(button, e);\r\n              };\r\n            }\r\n          }\r\n\r\n          /**\r\n           * Adding identifier\r\n           */\r\n          buttonDOM.setAttribute(\"data-skBtn\", button);\r\n\r\n          /**\r\n           * Adding unique id\r\n           * Since there's no limit on spawning same buttons, the unique id ensures you can style every button\r\n           */\r\n          const buttonUID = `${this.options.layoutName}-r${rIndex}b${bIndex}`;\r\n          buttonDOM.setAttribute(\"data-skBtnUID\", buttonUID);\r\n\r\n          /**\r\n           * Adding button label to button\r\n           */\r\n          const buttonSpanDOM = document.createElement(\"span\");\r\n          buttonSpanDOM.innerHTML = buttonDisplayName;\r\n          buttonDOM.appendChild(buttonSpanDOM);\r\n\r\n          /**\r\n           * Adding to buttonElements\r\n           */\r\n          if (!this.buttonElements[button]) this.buttonElements[button] = [];\r\n\r\n          this.buttonElements[button].push(buttonDOM);\r\n\r\n          /**\r\n           * Appending button to row\r\n           */\r\n          rowDOM.appendChild(buttonDOM);\r\n        });\r\n\r\n        /**\r\n         * Parse containers in row\r\n         */\r\n        rowDOM = this.parseRowDOMContainers(\r\n          rowDOM,\r\n          rIndex,\r\n          containerStartIndexes,\r\n          containerEndIndexes\r\n        );\r\n\r\n        /**\r\n         * Appending row to hg-rows\r\n         */\r\n        this.keyboardRowsDOM.appendChild(rowDOM);\r\n      }\r\n    );\r\n\r\n    /**\r\n     * Appending row to keyboard\r\n     */\r\n    this.keyboardDOM.appendChild(this.keyboardRowsDOM);\r\n\r\n    /**\r\n     * Calling onRender\r\n     */\r\n    this.onRender();\r\n\r\n    if (!this.initialized) {\r\n      /**\r\n       * Ensures that onInit and beforeFirstRender are only called once per instantiation\r\n       */\r\n      this.initialized = true;\r\n\r\n      /**\r\n       * Handling parent events\r\n       */\r\n      /* istanbul ignore next */\r\n      if (\r\n        this.utilities.pointerEventsSupported() &&\r\n        !useTouchEvents &&\r\n        !useMouseEvents\r\n      ) {\r\n        document.onpointerup = (e: KeyboardHandlerEvent) =>\r\n          this.handleButtonMouseUp(undefined, e);\r\n        this.keyboardDOM.onpointerdown = (e: KeyboardHandlerEvent) =>\r\n          this.handleKeyboardContainerMouseDown(e);\r\n      } else if (useTouchEvents) {\r\n        /**\r\n         * Handling ontouchend, ontouchcancel\r\n         */\r\n        document.ontouchend = (e: KeyboardHandlerEvent) =>\r\n          this.handleButtonMouseUp(undefined, e);\r\n        document.ontouchcancel = (e: KeyboardHandlerEvent) =>\r\n          this.handleButtonMouseUp(undefined, e);\r\n\r\n        this.keyboardDOM.ontouchstart = (e: KeyboardHandlerEvent) =>\r\n          this.handleKeyboardContainerMouseDown(e);\r\n      } else if (!useTouchEvents) {\r\n        /**\r\n         * Handling mouseup\r\n         */\r\n        document.onmouseup = (e: KeyboardHandlerEvent) =>\r\n          this.handleButtonMouseUp(undefined, e);\r\n        this.keyboardDOM.onmousedown = (e: KeyboardHandlerEvent) =>\r\n          this.handleKeyboardContainerMouseDown(e);\r\n      }\r\n\r\n      /**\r\n       * Calling onInit\r\n       */\r\n      this.onInit();\r\n    }\r\n  }\r\n}\r\n\r\nexport default SimpleKeyboard;\r\n","export const getDefaultLayout = () => {\r\n  return {\r\n    default: [\r\n      \"` 1 2 3 4 5 6 7 8 9 0 - = {bksp}\",\r\n      \"{tab} q w e r t y u i o p [ ] \\\\\",\r\n      \"{lock} a s d f g h j k l ; ' {enter}\",\r\n      \"{shift} z x c v b n m , . / {shift}\",\r\n      \".com @ {space}\",\r\n    ],\r\n    shift: [\r\n      \"~ ! @ # $ % ^ & * ( ) _ + {bksp}\",\r\n      \"{tab} Q W E R T Y U I O P { } |\",\r\n      '{lock} A S D F G H J K L : \" {enter}',\r\n      \"{shift} Z X C V B N M < > ? {shift}\",\r\n      \".com @ {space}\",\r\n    ],\r\n  };\r\n};\r\n","import SimpleKeyboard from \"./components/Keyboard\";\r\nexport { SimpleKeyboard };\r\nexport default SimpleKeyboard;\r\n"],"sourceRoot":""}